"use strict";var ActionUI=function(e){"use strict";/**
	 * Utilities
	 */ // Recursively copy source properties to target (Warning: Classes are treated as Objects)
function t(e,o,n=!1){for(let a in n&&(o=Object.assign(Array.isArray(o)?[]:{},o)),o)o.hasOwnProperty(a)&&(n&&o[a]instanceof Object&&(o[a]=Object.assign(Array.isArray(o[a])?[]:{},o[a])),e.hasOwnProperty(a)?(n&&e[a]instanceof Object&&(e[a]=Object.assign(Array.isArray(e[a])?[]:{},e[a])),e[a]instanceof Object&&o[a]instanceof Object&&!(e[a]instanceof Function||o[a]instanceof Function)?t(e[a],o[a]):e[a]!=o[a]&&(e[a]=o[a])):e[a]=o[a],Array.isArray(e[a])&&Array.isArray(o[a])&&0==o[a].length&&0!=e[a].length&&(e[a]=[]));return e;// For simpler dereference usage
}function o(e,o){return t(e,o,!0)}function n(e){return"FORM"==e.tagName?e:e.form}function a(e){return e[0].toUpperCase()+e.substr(1).toLowerCase()}function i(e){return e.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(e,t)=>t.toUpperCase())}function s(e,t){return null==e||e.matches(t)?e:s(e.parentElement,t)}function r(e,o={}){return o=Object.assign(Object.fromEntries(new FormData(e)),o),Object.entries(o).map(e=>{const n=e[0].split("[").map(e=>e.replace(/]/g,""));if(1<n.length){const a=p(n,e[1]);t(o,a),delete o[e[0]]}return e}),o}function p(e,t,o){const n=e.pop();if(!n)return o;let a={};return a[n]=o?o:t,p(e,t,a)}var d=/*#__PURE__*/Object.freeze({__proto__:null,deepAssign:t,deepCopy:o,requestFromElement:function(e){return new Request(e.action||options.href||null,{method:e.method||null})},form:n,capitalize:a,camelCase:i,firstMatchingParentElement:s,formToObject:r});/**
	 * Model
	 * @version 20230914
	 * @description Observable data object
	 */class l{constructor(e={},t=null){let o=null;try{o=new Proxy(this,{set:this.constructor._proxySet,deleteProperty:this.constructor._proxyDelete})}catch(t){o=new Proxy(this,{set:this.constructor._proxySet})}// Set private properties
return o._options={triggerDelay:10},o._changes={},o._watchers=[],o._timer=null,o._parent=t,o._loading=!1,o.sync(e),o.clearChanges(),o}clear(){for(let t in this)try{delete this[t]}catch(o){// Fallback for IE11
let e=this[t];this[t]=void 0,this._change(t,void 0,e)}return this}loading(e){return 0==arguments.length?this._loading:void(this._loading=!!e)}// Sync data object to model
sync(e){return e&&(e=t({},e,!0),t(this,e)),this}// Add watcher callback
watch(e){return this._watchers.push(e),this}clearChanges(){return this._changes={},this}triggerChanges(e){for(const t in e)e.hasOwnProperty(t)&&this._change(t,e[t],this[t])}// @deprecated
_privatize(){for(let e in this)"_"==e[0]&&Object.defineProperty(this,e,{enumerable:!1})}// Trigger all watcher callbacks
_trigger(e=!1){if(window.clearTimeout(this._timer),this._timer=null,e||0<Object.keys(this._changes).length){let e=this._watchers;for(let t in e)e[t].call(this,this._changes);null!=this._parent&&null!=this._parent.property&&this._parent.model.triggerChanges({child:this,changes:this._changes}),this._changes={}}}// Log property change
_change(e,t,o){this._changes[e]={value:t,originalValue:o},window.clearTimeout(this._timer),this._timer=window.setTimeout(()=>this._trigger(),this._options.triggerDelay)}static _proxySet(e,t,o){let n=e[t];if(e[t]&&e[t]instanceof l)e[t].sync(o);else if(window.Reflect&&window.Reflect.set)!(o instanceof Object)||Array.isArray(o)||o instanceof l||"_"==t[0]||(o=new l(o,{model:e,property:t})),Reflect.set(e,t,o);else throw"Missing Model dependency: Reflect.set()";return"_"==t[0]?(Object.defineProperty(e,t,{enumerable:!1}),!0):(e._change(t,o,n),!0)}static _proxyDelete(e,t){if(t in e){let o=e[t];delete e[t],e._change(t,void 0,o)}return!0}}/**
	 * @class Action
	 * @version 20231116
	 * @description Allows named handlers to be handled as state-aware deferred promises with before/after events
	 */class c{constructor(e,t,o){this.name=e,this.handler=t||((e,t,o)=>e(o)),this.model=o?o:new l,this.running=!1,h.autoCache&&c.cache(this)}// trigger before event and run the handler as a promise 
run(e,t={}){h.verbose&&console.info("Action.run()",this.name,{action:this,target:e,data:t}),this.running=!0,e=e||document.body,t=Object.assign(t,c.data(e));let o=!this.before(e,t);var n=null;if(o)n=Promise.reject(new u("Canceled"));else if(this.handler instanceof Function)n=new Promise((e,o)=>this.handler(e,o,t));else if(this.handler instanceof Request){// If there is data to send, recreate the request with the data
if(0<Object.keys(t).length){let o={};for(let e in this.handler)o[e]=this.handler[e];if("POST"!=o.method)"GET"==o.method&&(// Append query string to URL with ?/& first as needed
o.url+=(0>o.url.indexOf("?")?"?":"&")+Object.keys(t).map(e=>e+"="+t[e]).join("&"));else if(e.attributes.enctype&&"application/json"==e.attributes.enctype.value)o.body=JSON.stringify(t);else{let e=new FormData;for(let o in t)e.append(o,t[o]);o.body=e}this.handler=new Request(o.url,o)}n=fetch(this.handler).then(e=>e.json().then(t=>e.ok?t:Promise.reject(t)))}return n.then(o=>this.after(e,!0,o,t),o=>this.after(e,!1,o,t))}syncModel(e){return e=t({},e,!0),h.verbose&&console.info("Action.syncModel()",this.name,{action:this,data:e}),e instanceof Object||(e={result:e}),this.model.sync&&this.model.sync instanceof Function?this.model.sync(e):this.model instanceof Object&&t(this.model,e),e}before(e,t){if(h.verbose&&console.info("Action.before()",this.name,{action:this,target:e,data:t}),c.setCssClass(e,h.cssClass.loading,t),c.reflectCssClass(this.name,h.cssClass.loading,t),h.eventBefore){const o=new h.eventBefore({name:this.name,data:t,model:this.model});return h.eventTargetFallbackToDocument&&!document.body.contains(e)?document.dispatchEvent(eventAfter):e.dispatchEvent(o)}return!0}after(e,t,o,n){h.verbose&&console.info("Action.after()",this.name,{action:this,target:e,data:n,success:t,result:o}),this.running=!1;var a=o instanceof u,i=t?h.cssClass.success:h.cssClass.fail;if(a&&(i=h.cssClass.canceled),c.setCssClass(e,i,n),c.reflectCssClass(this.name,i,n),t&&null!=o&&!(o instanceof Error)&&this.syncModel(o),h.eventAfter){const i=new h.eventAfter({name:this.name,success:t,data:n,model:t?this.model:new l(o),error:!!(o instanceof Error)&&o,canceled:a});h.eventTargetFallbackToDocument&&!document.body.contains(e)?(h.verbose&&console.warn("Action.after() target element missing from DOM",{target:e}),document.dispatchEvent(i)):e.dispatchEvent(i)}return o}// #region Static methods
// Initialize the action cache and top-level event listener (only once)
static init(){document.addEventListener("click",t=>{let e=t.target.closest("[ui-action]");if(e&&"FORM"!=e.tagName&&!t.target.disabled&&!t.target.closest("[disabled]")){"INPUT"==e.tagName&&("checkbox"==e.type||"radio"==e.type)||t.preventDefault();var o=e.getAttribute("ui-action");// Don't run the action if it's already running
if(o in m)!1==m[o].running&&m[o].run(e);else if(h.autoCreate){// Auto create and run action
var n=c.createFromElement(e);c.cache(n),n.run(e)}else throw new Error("Action not found: "+o)}}),document.addEventListener("submit",t=>{if(t.target.matches("form[ui-action]")&&!t.target.disabled&&!t.target.closest("[disabled]")){t.preventDefault();var e=t.target.getAttribute("ui-action");// Don't run the action if it's already running
if(e in m)!1==m[e].running&&m[e].run(t.target);else if(h.autoCreate){// Auto create and run action
var o=c.createFromElement(t.target);c.cache(o),o.run(t.target)}else throw new Error("Action not found: "+e)}})}static create(e,t=!0){if(h.verbose&&console.info(this.name+":create()",{options:e,fromCache:t}),!1=="name"in e)throw"No action name specfied";return!1=="handler"in e&&(!0=="url"in e&&e.url?e.handler=new Request(e.url,e.request||{}):e.handler=null),t?this.cache(e.name)||new this(e.name,e.handler,e.model):new this(e.name,e.handler,e.model)}static createFromElement(e,t={}){return c.create(Object.assign({name:e.getAttribute("ui-action")||null,url:e.action||e.href||t.href||null,request:{method:e.method||t.method||"GET"}},t))}// Cache an action 
static cache(e){return null==e?m:"string"==typeof e?m[e]:e.name in m?this:(m[e.name]=e,this)}static data(e){var t=e.dataset||{},o=n(e);return o&&(t=r(o,t)),t}static get(e){return m[e]}static setCssClass(e,t,o=null){if(console.warn("Action.setCsClass()",{target:e,cssClass:t,data:o}),!!!e.attributes["ui-nostate"]){if(null!=o&&!!e.attributes["ui-state-data"]){let n=!0,a=JSON.parse(e.attributes["ui-state-data"].value);for(let s in console.warn("Action.setCsClass()",{target:e,cssClass:t,data:o,requiredDataValues:a}),a)if(n=o[s]==a[s],!1===n)break;if(!1==n)return}for(var n in h.cssClass)e.classList.remove(h.cssClass[n]);e.classList.add(t)}}// Propagate class to all reflectors (ui-state and form submit buttons)
static reflectCssClass(e,t,o=null){document.querySelectorAll("form[ui-action=\""+e+"\"] [type=\"submit\"], form[ui-action=\""+e+"\"] button:not([type]), [ui-state=\""+e+"\"], [ui-state^=\""+e+",\"], [ui-state*=\","+e+",\"], [ui-state$=\","+e+"\"]").forEach(e=>c.setCssClass(e,t,o))}static get options(){return h}static set options(e){t(h,e)}// #endregion
}class u extends Error{}class y extends Event{constructor(e){super("action.before",{bubbles:!0,cancelable:!0}),this.detail={type:"before",name:null,data:null,model:null},Object.assign(this.detail,e)}}class g extends Event{constructor(e){super("action.after",{bubbles:!0,cancelable:!0}),this.detail={type:"after",name:null,data:null,model:null,success:null,error:null,canceled:null},Object.assign(this.detail,e)}}let m={},h={verbose:!1,autoCreate:!0,autoCache:!0,cssClass:{loading:"loading",success:"success",fail:"fail",canceled:"canceled"},eventTargetFallbackToDocument:!0,eventBefore:y,eventAfter:g};c.init();/**
	 * Controller
	 * Provider route mapping for SPAs
	 */class f{constructor(e){this.view=e}__autoload(){return this.view.render()}__error(){return this.view.render()}get view(){return this._view}set view(e){this._view=e}}/**
	 * JsonApi
	 * @description Json API data store
	 * @tutorial var store = new JsonApi('http://localhost:8080/api', ['category', 'product'])
	 */ /**
	 * @class Store
	 * @version 20231116
	 * @description Remote data store
	 * @tutorial let store = new Store({baseUrl:'http://localhost:8080/api', types:['category', 'product']})
	 */class _{constructor(e){// Accept an array of store keys
if(this.options={baseUrl:null,types:null,keys:{data:null,type:"type",id:"id"},keysExcludeFromCache:[],defaultPageSize:0,query:{"page[number]":"page[number]","page[size]":"page[size]"},fetch:{method:"GET",headers:{"Content-Type":"application/json"},mode:"no-cors"},searchDepth:1,triggerChangesOnError:!0,// Allows views to update contents on failed requests, especially useful for Fetch All requests which return no results or 404
triggerChangesOnEmpty:!0,useUrlCache:!0,verbose:!1,viewClass:null,viewMap:{},actionVerb:{get:"fetch",post:"create",patch:"update",delete:"delete"},actionHandler:{get:this.actionHandler,post:this.actionHandler,patch:this.actionHandler,delete:this.actionHandler},eventBefore:b,eventAfter:C},t(this.options,e||{}),this._model=new l,this._urlCache={},this._model._paging={},this.options.types instanceof Array){let e={};// Turn them into seperate stores
for(let t in this.options.types)e[this.options.types[t]]=this.options.types[t];this.options.types=e}if(this.options.types instanceof Object)for(let e in this.options.types)this.modelCreate(this.options.types[e]);_.cache(this)}body(e,t){return JSON.stringify(t)}model(e,t){return t?this._model[e][t]:this._model[e]}modelCreate(e,t=null,o=null){if("string"!=typeof e)throw new Error("Store: Cannot create model without `type`");if(!this._model[e]){let n={};if(null==t&&o&&(n=o),n._type=e,this._model[e]=new l(n,{model:this._model,property:e}),this.actionCreate(e,"get"),this.actionCreate(e,"post"),this.actionCreate(e,"patch"),this.actionCreate(e,"delete"),this.options.viewClass&&this.options.viewMap.hasOwnProperty(e))if(Array.isArray(this.options.viewMap[e]))for(let t of this.options.viewMap[e])this.options.viewClass.create({name:t,file:t,model:this._model[e]});else{let t=this.options.viewMap[e];this.options.viewClass.create({name:t,file:t,model:this._model[e]})}}else this._model[e].sync(o);return null==t||"string"!=typeof t&&"number"!=typeof t||this._model[e][t]?null!=t&&o&&this._model[e][t].sync(o):(o=o||{},o._type=e,this._model[e][t]=new l(o,{model:this._model[e],property:t})),t?this._model[e][t]:this._model[e]}actionCreate(e,t){t=t.toLowerCase();var o=e+" "+this.options.actionVerb[t],n=this.options.actionHandler[t].bind(this,e,t),a=new c(o,n);return c.cache(a),a}actionHandler(e,t,o,n,a){let i=null;return"get"===t?i=this.fetch(e,a.id):"post"===t?i=this.post(e,a):"patch"===t?i=this.patch(e,a):"delete"===t?i=this.delete(e,a.id):void 0,i.then(e=>o(e)).catch(e=>n(e))}data(e){return this.options.keys.data?e[this.options.keys.data]:e}type(e){let t=e[this.options.keys.type];return this.options.types[t]&&(t=this.options.types[t]),t}id(e){return e[this.options.keys.id]}sync(e,t,o=!1){let n=this.data(e);if(!n||0==Object.keys(n).length)throw o||this.syncPaging(e,t),new v("Store: No data to sync");if(n instanceof Array){let a={};for(let e in n){let o=null;this.options.keys.data?(o={},o[this.options.keys.data]=n[e]):o=n[e],a[this.id(n[e])]=this.sync(o,t)}return o||this.syncPaging(e,t),a}let a=this.type(n),i=this.id(n);if(this._model[a]||this.modelCreate(a),this._model[a][i]||this.modelCreate(a,i),!this._model[a][i])throw new Error("Store: No model for type: "+a+", id: "+i);return this._model[a][i].sync(n),t&&(!this._model[a][i].hasOwnProperty("_store")&&(this._model[a][i]._store={url:[]}),-1==this._model[a][i]._store.url.indexOf(t)&&this._model[a][i]._store.url.push(t),t=this.url({type:a,id:i}),-1==this._model[a][i]._store.url.indexOf(t)&&this._model[a][i]._store.url.push(t)),this._model[a][i]}syncPaging(e,t){let n=this.pageData(t);// Paging
if(n.type&&n.pageSize&&n.pageNumber){let a=this.pageKey(n.pageSize,n.query),i=this.data(e);if(Array.isArray(i)){let e=this.model(n.type),s=[],r=o({},n);for(let e of i)s.push({id:e[this.options.keys.id],type:e[this.options.keys.type]});r.data=s,r.url=[t],e._paging||(e._paging=new l({current:null,type:n.type,pageNumber:n.pageNumber,pageSize:n.pageSize,pageKey:a},{model:e,property:"_paging"})),e._paging[a]||(e._paging[a]=new l({},{model:e._paging,property:a})),e._paging[a][n.pageNumber]||(e._paging[a][n.pageNumber]=new l({},{model:e._paging[a],property:n.pageNumber})),e._paging[a][n.pageNumber].sync(r)}return this.pageChange(n.type,n.pageNumber,n.pageSize,n.query)}}url(e){let t=this.options.types[e.type]||e.type,o=this.options.baseUrl+"/"+t+"/"+(e.id?e.id+"/":""),n=new URLSearchParams;for(let t in e)t in this.options.query?n.set(this.options.query[t],e[t]):"type"!=t&&"id"!=t&&n.set(t,e[t]);n.sort();let a=n.toString();return a&&(o+="?"+a),o}urlParse(e){if(!e)return{url:null,type:null,pageNumber:!1,pageSize:!1};-1==e.indexOf("://")&&(0<e.indexOf("/")&&(e="/"+e),e=location.origin+e);let t=this.options.baseUrl;-1==t.indexOf("://")&&(0<t.indexOf("/")&&(t="/"+t),t=location.origin+t);let o=new URL(e),n=new URL(t),a=o.pathname.replace(n.pathname,"").split("/"),i=a[0]||a[1];o.searchParams.sort();let s={};return o.searchParams.forEach((e,t)=>s[t]=e),{url:o,type:i,pageNumber:parseInt(o.searchParams.get(this.options.query["page[number]"])),pageSize:parseInt(o.searchParams.get(this.options.query["page[size]"])),query:s}}search(e){let t=new l;for(let o in this._model)if(!(0==o.indexOf("_")||e.type&&this.type({type:e.type})!=o))for(let n in this._model[o]){let a=!1,i=this._model[o][n];for(let t in e)a=this.propertyValueExists(i,t,e[t],this.options.searchDepth);a&&(t[n]=i)}return t}propertyValueExists(e,t,o,n=1){var a=Object.keys(e);if(-1<a.indexOf(t))return e[t]==o;if(1>=n)return!1;for(let i of a)if("object"==typeof e[i])return this.propertyValueExists(e[i],t,o,n-1)}async fetch(e,t,n={}){e=this.type({type:e}),n=n||{},t=t||void 0,"object"==typeof t&&(n=t,t=n.id);let a={type:e,id:t},i={};o(i,this.options.fetch),this.before(e,i,a,n);let s=this.url(Object.assign({},n,a));return this.options.verbose&&console.info("Store.fetch()",e,t,{type:a.type,id:a.id,query:n,store:this,url:s,options:i}),this.fetchUrl(s,a.type,n,i,!0)}async fetchUrl(e,t,n={},a=null,i=!1){if(!e)return Promise.reject();null==a&&(a={},o(a,this.options.fetch));try{n=n||{},n.type=t;let o=this.urlParse(e).url.toString(),s=this.urlCache(o);if(t=n.type||(s?s.type:null)||o.type||null,s)return this.pageChange(s.type,s.pageNumber,s.pageSize,s.pageData.query),n.cached=!0,this.after(s.type,null,n,!0,null,null,s.pageData.query),Promise.resolve(s.model);i||this.before(t,a,n);const r=await fetch(e,a);let p=await r.json();if(this.after(t,this.options.fetch,n,!!r&&r.ok,r,p),!r.ok)return Promise.reject(p);let d=this.sync(p,e);return this.urlCache(o,d,p),Promise.resolve(d)}catch(e){return t&&this.options.triggerChangesOnError&&this._model[t]&&this.model(t).triggerChanges({__error:e}),await Promise.reject(e)}}urlCache(e,t=null,o=null){if(!this.options.useUrlCache)return!1;if(e=decodeURIComponent(e),!t&&!o)return this._urlCache[e];let n=this.pageData(e),a=t[this.options.keys.type]||t._type||(n?n.type:null);if(o)for(let e of this.options.keysExcludeFromCache)delete o[e];return this._urlCache[e]={url:e,type:a,model:t,json:o,pageData:n,pageNumber:!!n&&n.pageNumber,pageSize:!!n&&n.pageSize}}urlCacheClear(e,t=!1){if(!e)return void(this._urlCache={});let o=Object.keys(this._urlCache);for(var n of o)this._urlCache[n].type==e&&(!t||this._urlCache[n].pageNumber&&this._urlCache[n].pageSize)&&delete this._urlCache[n]}pageData(e){if(!e)return{type:null,pageNumber:!1,pageSize:!1};let t=this.urlParse(e),o=this._urlCache[e],n=t.pageSize||!!o&&o.pageSize,a=t.query||(o?o.query:{});return{type:t.type||(o?o.type:null),pageNumber:t.pageNumber||!!o&&o.pageNumber,pageSize:n,pageKey:this.pageKey(n,a),query:a,cached:!!o}}paging(e){return this.model(e)._paging||{current:!1,pageNumber:!1,pageSize:!1,pageKey:!1}}async pagingReset(e){this.urlCacheClear(e,!0);let t=!1,o=!1,n=!1;return this._model[e]._paging&&(this._model[e]._paging.current&&(t=this._model[e]._paging.current.pageNumber,o=this._model[e]._paging.current.pageSize,n=this._model[e]._paging.current.query,1>=this._model[e]._paging.current.data.length&&1<t&&--t),delete this._model[e]._paging),t&&o?this.page(e,t,o,n):Promise.resolve()}async page(e,t=1,o=0,n={}){return n=n||{},o=parseInt(o)||this.options.defaultPageSize,t=parseInt(t)||1,n.type=e,n[this.options.query["page[number]"]]=t,n[this.options.query["page[size]"]]=o,await this.fetch(e,0,n)}pageChange(e,t,o,n={}){let a=this.pageKey(o,n);return!!(e&&a&&t&&o&&this._model[e]._paging&&this._model[e]._paging[a][t])&&(this._model[e]._paging.pageNumber=t,this._model[e]._paging.pageSize=o,this._model[e]._paging.pageKey=a,delete this._model[e]._paging.current,this._model[e]._paging.current=this._model[e]._paging[a][t],this._model[e]._paging)}pageKey(e,t={}){t[this.options.query["page[size]"]]=e,delete t[this.options.query["page[number]"]];let o=new URLSearchParams(t);return o.sort(),o.toString()}async post(e,t,n={}){e=e||this.type(t);let a={};o(a,this.options.fetch),a.method="POST",a.body=this.body(e,t),this.before(e,a,t,n);let i=this.url(Object.assign({},n,{type:e,id:this.id(t)}));this.options.verbose&&console.info("Store.post()",e,{type:e,data:t,query:n,store:this,url:i,options:a});try{const o=await fetch(i,a);let s=await o.json();return(this.after(e,a,t,!!o&&o.ok,o,s,n),!o.ok)?Promise.reject(s):(this.pagingReset(e),this.sync(s,i))}catch(t){return this.options.triggerChangesOnError&&this.model(e).triggerChanges({__error:t}),Promise.reject(t)}}async patch(e,t,n={}){e=e||this.type(t);let a={};o(a,this.options.fetch),a.method="PATCH",a.body=this.body(e,t),this.before(e,a,t,n);let i=this.url(Object.assign({},n,{type:e,id:this.id(t)}));this.options.verbose&&console.info("Store.patch()",e,{type:e,data:t,query:n,store:this,url:i,options:a});try{const o=await fetch(i,a);let s=await o.json();return this.after(e,a,t,!!o&&o.ok,o,s,n),o.ok?this.sync(s,i):Promise.reject(s)}catch(t){return this.options.triggerChangesOnError&&this.model(e).triggerChanges({__error:t}),Promise.reject(t)}}async delete(e,t,n={}){let a={};a[this.options.keys.id]=t;let i={};o(i,this.options.fetch),i.method="DELETE",this.before(e,i,a,n);let s=this.url(Object.assign({},n,{type:e,id:a.id}));this.options.verbose&&console.info("Store.delete()",e,t,{type:e,id:a.id,query:n,store:this,url:s,options:i});try{const o=await fetch(s,i);let r=await o.json();if(this.after(e,i,a,!!o&&o.ok,o,r,n),!o.ok)return Promise.reject(r);//#region Remove items sent back in response
let p=this.data(r),d=[e];if(Array.isArray(p))for(let e in p){let t=this.type(p[e]),o=this.id(p[e]);t&&o&&this._model[t]&&this._model[t][o]&&(-1==d.indexOf(t)&&d.push(t),delete this._model[t][o])}else{let e=this.type(p),t=this.id(p);e&&t&&this._model[e]&&this._model[e][t]&&(-1==d.indexOf(e)&&d.push(e),delete this._model[e][t])}//#endregion Remove items sent back in response
this._model[e][t]&&delete this._model[e][t];for(let e of d)this.pagingReset(e).catch(()=>{});return r}catch(t){return this.options.triggerChangesOnError&&this.model(e).triggerChanges({__error:t}),Promise.reject(t)}}loading(e,t){this._model[e]||this.modelCreate(e);const o=this.model(e);return 1==arguments.length?o.loading():void o.loading(t)}before(e,t,o,n={}){let a=this.options.baseUrl+"/"+e,i=null;if(this.loading(e,!0),this.options.viewClass&&this.options.viewMap.hasOwnProperty(e)&&(i=this.options.viewClass.cache(this.options.viewMap[e])),this.options.verbose&&console.info("Store.before()",a,{store:this,type:e,fetch:t,data:o,view:i,model:this.model(e),query:n}),i&&document.querySelectorAll("[ui-view=\""+i.name+"\"]").forEach(e=>{this.options.viewClass.setCssClass(e,this.options.viewClass.options.cssClass.loading)}),this.options.eventBefore){const s=new this.options.eventBefore({name:a,fetch:t,store:this,type:e,data:o,model:this.model(e),view:i,query:n});return document.dispatchEvent(s)}return!0}after(e,t,o,n,a,i,s={}){let r=this.options.baseUrl+"/"+e,p=null;if(this.loading(e,!1),this.options.viewClass&&this.options.viewMap.hasOwnProperty(e)&&(p=this.options.viewClass.cache(this.options.viewMap[e])),this.options.verbose&&console.info("Store.after()",r,{store:this,type:e,fetch:t,data:o,view:p,model:this.model(e),success:n,response:a,json:i,query:s}),p&&document.querySelectorAll("[ui-view=\""+p.name+"\"]").forEach(e=>{t&&"GET"==t.method?this.options.viewClass.setCssClass(e,n?this.options.viewClass.options.cssClass.success:this.options.viewClass.options.cssClass.fail):e.classList.remove(this.options.viewClass.options.cssClass.loading)}),this.options.eventAfter){const d=new this.options.eventAfter({name:r,success:n,fetch:t,store:this,type:e,data:o,model:this.model(e),view:p,response:a,json:i,query:s});return document.dispatchEvent(d)}return!0}static cache(e){if(null==e)return k;if("string"==typeof e){if(e=e.toLowerCase(),null!=k[e])return k[e];// Find a store that starts with the requested url to match ('/api/v1/entity' with a '/api/v1' store)
for(var t in k)if(t.startsWith(e))return k[t];return}var o=e.options.baseUrl.toLowerCase();return o in k?this:(k[o]=e,this)}}class v extends Error{}class b extends Event{constructor(e){super("store.before",{bubbles:!0,cancelable:!0}),this.detail={type:"before",name:null,fetch:null,type:null,data:null,model:null,view:null,query:null},Object.assign(this.detail,e)}}class C extends Event{constructor(e){super("store.after",{bubbles:!0}),this.detail={type:"after",name:null,fetch:null,type:null,data:null,model:null,view:null,query:null,json:null},Object.assign(this.detail,e)}}let k={};/**
	 * @class View
	 * @version 20230829
	 * @description Creates a view that will be inserted into elements with ui-view="{{name}}" and updated when its attached model changes
	 */class w{constructor(e,t,o){o instanceof l||(o=new l(o)),this._name=e,this._html=t,this._model=o,o.watch(e=>this.update(e)),this.constructor.options.autoCache&&w.cache(this)}clear(){return document.querySelectorAll("[ui-view=\""+this._name+"\"]").forEach(e=>{e.innerHTML=""}),this}// When the model updates
update(e){this.constructor.options.verbose&&console.info(this.constructor.name+".update()",this.name,{view:this,changes:e}),0==Object.keys(e).length||this.render()}// Render the model data into the view template for all elements with [ui-view=this.name]
/**
	     * Render view to all matching containers
	     * @returns Promise
	     */render(e){const t=document.querySelectorAll("[ui-view=\""+this._name+"\"]");if(0==t.length)return Promise.resolve();let o=null;this.constructor.options.eventRenderBefore&&(o=new this.constructor.options.eventRenderBefore({name:this.model.view,view:this}));let n=null;return this.constructor.options.eventRender&&(n=new this.constructor.options.eventRender({name:this.model.view,view:this})),t.forEach(t=>{let a=!!o&&!t.dispatchEvent(o);a||(this.constructor.options.verbose&&console.info(this.constructor.name+".render()",this.name,{view:this,target:t,parent:e}),t.innerHTML=n?n.detail.view.html:this.html,n&&t.dispatchEvent(n),this.renderSubviews(t))}),Promise.resolve()}renderSubviews(e){const t=e.querySelectorAll("[ui-view]:not([ui-view=\""+e.getAttribute("ui-view")+"\"])");return 0==t.length?Promise.resolve():void t.forEach(t=>{let o=t.getAttribute("ui-view"),n=this.constructor.cache(o);n&&n.render(e)})}get name(){return this._name}get html(){return this._html instanceof Function?this._html(this._model):this._html}set html(e){this._html=e}get model(){return this._model}// #region Static methods
// View factory
static create(e,t=!0){return this.options.verbose&&console.info(this.name+":create()",{options:e,fromCache:t}),t&&e.name?this.cache(e.name)||new this(e.name,e.html,e.model):new this(e.name,e.html,e.model)}// Cache a view 
static cache(e){if(this.options.verbose&&console.info(this.name+":cache()",{view:e}),"string"==typeof e)return A[e];if(e instanceof w){if(e.name in A)throw"View name already exists: \""+e.name+"\"";return A[e.name]=e,this}return A}// Render all views
static get options(){return R}static set options(e){t(R,e)}// #endregion
}class S extends Event{constructor(e){super("view.render.before",{bubbles:!0,cancelable:!0}),this.detail={type:"render.before",name:null,view:null},Object.assign(this.detail,e)}}class E extends Event{constructor(e){super("view.render",{bubbles:!0,cancelable:!0}),this.detail={type:"render",name:null,view:null},Object.assign(this.detail,e)}}let A={},R={verbose:!1,autoCache:!0,// Automatically cache views when created
eventRenderBefore:S,eventRender:E};/**
	 * ViewFile
	 * @description View that fetches html from a file
	 */class q extends w{constructor(e,t,o){2==arguments.length&&(o=t,t=void 0),t||(t=e),super(e,null,o),this.file=t}clear(){return this.html=null,super.clear()}render(e){var t=null==this._html?this.fetch():Promise.resolve();return t.then(()=>super.render(e))}fetch(){return this.constructor.options.verbose&&console.info(this.constructor.name+".fetch()",this.name,{view:this}),this.fetchBefore(),fetch(this.fullPath).then(e=>{if(e.ok)return e.text();throw new Error(e.statusText)}).then(e=>(this._html=e,this.fetchAfter(!0),this._html)).catch(()=>{throw this.fetchAfter(!1),new Error("File not found: "+this.fileName)})}fetchBefore(){if(this.constructor.options.verbose&&console.info(this.constructor.name+".fetchBefore()",this.name,{view:this}),document.querySelectorAll("[ui-view=\""+this._name+"\"]").forEach(e=>{this.constructor.setCssClass(e,N.cssClass.loading)}),this.constructor.options.eventFetch){const e=new this.constructor.options.eventFetch({view:this,success:null});document.dispatchEvent(e)}return!0}fetchAfter(e){if(this.constructor.options.verbose&&console.info(this.constructor.name+".fetchAfter()",this.name,{view:this}),document.querySelectorAll("[ui-view=\""+this._name+"\"]").forEach(t=>{this.constructor.setCssClass(t,e?N.cssClass.success:N.cssClass.fail)}),this.constructor.options.eventFetch){const t=new this.constructor.options.eventFetch({view:this,success:e});document.dispatchEvent(t)}return e}get fileName(){return this.file+"."+this.constructor.options.extension}get fullPath(){return this.constructor.options.basePath+this.fileName}get file(){return this._file}set file(e){e!=this._file&&(this._html=null),this._file=e}// #region Static methods
// View factory
static create(e,t=!0){return this.options.verbose&&console.info(this.name+":create()",{options:e,fromCache:t}),e.file||(e.file=e.name),t&&e.name?this.cache(e.name)||new this(e.name,e.file,e.model):new this(e.name,e.file,e.model)}static setCssClass(e,t){for(var o in N.cssClass)e.classList.remove(N.cssClass[o]);e.classList.add(t)}static get options(){return N}static set options(e){t(N,e)}// #endregion
}class z extends Event{constructor(e){super("view.fetch",{bubbles:!0}),this.detail={type:"fetch",view:null,success:null},Object.assign(this.detail,e)}}let N={basePath:"view/",extension:"html",cssClass:{loading:"loading",success:"success",fail:"fail"},eventFetch:z,eventRender:E};q.options=w.options;/**
	 * ViewHandlebars
	 * @description View that uses Handlebars templates instead of html
	 * @update Support for pre-compiled templates
	 */class P extends q{render(e){var t=Promise.resolve();return null==this.html&&Handlebars.templates&&Handlebars.templates[this.file]&&(this.html=Handlebars.templates[this.file]),t.then(()=>super.render(e))}fetch(){return super.fetch().then(e=>("templates"in Handlebars||(Handlebars.templates=[]),Handlebars.templates[this.file]=Handlebars.compile(e),this.html=Handlebars.templates[this.file],e))}// #region Static methods
static get options(){return T}static set options(e){t(T,e)}// #endregion
}let T={};P.options=q.options,P.options.extension="hbs";let O={},j={controllers:{},view:"controller",state:{},autoload:!0,verbose:!1,cssClass:{loading:"loading",success:"success",fail:"fail"},defaultController:"default",autoloadMethod:"__autoload",defaultMethod:"index",errorMethod:"__error",errorView:"error",useControllerErrorViews:!1,devHost:"localhost",interceptLinks:!0,pathSeparator:"/",routes:{}};return e.Action=c,e.ActionErrorCanceled=u,e.Controller=f,e.JsonApi=class extends l{constructor(e,t){// Accept an array of store keys
if(t instanceof Array){// Turn them into seperate stores
let e=t;for(let o in t=new l,e)t[e[o]]=new l}t._paging={},super(t),this.baseUrl=e}sync(e){if(!e.hasOwnProperty("data"))throw new Error("JsonApi: No data to sync");if(e.data instanceof Array){let t={};for(let o in e.data)t[e.data[o].id]=this.sync({data:e.data[o]});return t;//this[json.data[0].type]
}let o=e.data.type,n=e.data.id;return this[o]||(this[o]=new l),this[o][n]||(this[o][n]=new l),t(this[o][n],e.data),this[o][n]}fetch(e,t){if(this[e]){if(null!=t&&this[e][t])return Promise.resolve(this[e][t]);if(null==t)return Promise.resolve(this[e])}return fetch(this.baseUrl+"/"+e+(t?"/"+t:"")).then(e=>e.json()).then(e=>this.sync(e))}page(e,t=1,o=0){if(o=parseInt(o)||0,t=parseInt(t)||1,e in this._paging&&o in this._paging[e]&&t in this._paging[e][o])return Promise.resolve().then(()=>this._paging[e][o][t]);e in this._paging||(this._paging[e]={}),o in this._paging[e]||(this._paging[e][o]={}),t in this._paging[e][o]||(this._paging[e][o][t]=new l({type:e,number:t,size:o,count:0,links:{},model:new l}));let n="?page[number]="+t;return 0<o&&(n+="&page[size]="+o),fetch(this.baseUrl+"/"+e+n).then(e=>e.json()).then(n=>this._paging[e][o][t].sync({links:n.links||{},count:Object.keys(n.data).length,model:this.sync(n)}))}post(){/*
	        data = {
	            id: '1',
	            attributes: {}
	        }
	        */}},e.Model=l,e.Router=class{static start(){window.addEventListener("popstate",this.onPopState.bind(this)),j.interceptLinks&&document.addEventListener("click",this.onClick.bind(this)),this.navigate(location.pathname)}static route(e,t,o=0){this.options.routes[e]={route:e,callback:t,priority:o}}static match(e,t=!0){// Exact match
if(this.options.routes[e])return t&&"string"==typeof this.options.routes[e].callback?this.match(this.options.routes[e].callback):this.options.routes[e];let o=null;for(let n in Object.keys(this.options.routes))null!=e.match(n)&&(null==o||this.options.routes[n].priority<=o.priority)&&(o=this.options.routes[n]);// If route is a forward
return o&&t&&"string"==typeof o.callback&&(o=this.match(o.callback)),o}static navigate(t,o={},n=null){j.verbose&&console.info("Router.navigate()",{router:this,route:t,data:o});let a=this.sanitizePath(t),s=a[0],r=a[1],p=this.controllerName(s),d={data:o},l=this.match(t,!1);if(l&&"string"==typeof l.callback)// Redirect
return this.navigate(l.callback,o,n);this.controllers[p]||(s=j.defaultController,p=this.controllerName(s),r="/"==t?j.defaultMethod:a[0]),O[p]||(this.controllers[p]?O[p]=new this.controllers[p](this.view):O[p]=new f(this.view)),r=r||j.defaultMethod;let u=null,y=s+j.pathSeparator+r,g=i(r);O[p].view instanceof q?O[p].view.file=y:O[p].view instanceof P&&(O[p].view.html=y),j.autoload&&!(O[p][g]instanceof Function)&&(g=j.autoloadMethod),d.dev=location.host==j.devHost,d.view=y,d.controller=s,d.method=r,d.path=Array.from(a),d.event=n;// Query string to object
let m=location.search.substring(1);m&&(m=JSON.parse("{\""+decodeURI(m).replace(/"/g,"\\\"").replace(/&/g,"\",\"").replace(/=/g,"\":\"")+"\"}"),d.search=m);try{let e=Array.from(a);if(e.shift(),e.shift(),e.push(m),e.push(o),!l)O[p].view.model.clear().sync(d).clearChanges(),u=O[p][g].apply(O[p],e),this.pushState(t,{controller:s,method:r,data:Object.assign({},o),search:m});else if(l.callback instanceof c){l.callback.model.clear().sync(d).clearChanges();let e=n?n.target:document;u=l.callback.run(e,o)}else e.push(d),u=l.callback.apply(O[p],e)}catch(n){this.options.verbose&&console.error("Routing Error",n),this.pushState(t,{controller:s,method:r,data:Object.assign({},o),search:m}),u=this.handleError(p,d,a)}if(u instanceof Promise){let t=document.querySelectorAll("[ui-view=\""+this.view.name+"\"]");this.handleLoading(t,!0),u.then(()=>this.handleLoading(t,!1)).catch(o=>{throw this.handleLoading(t,!1),this.handleError(p,d,a,o),o})}return u}static handleLoading(e,t){return t?e.forEach(e=>e.classList.add(j.cssClass.loading)):e.forEach(e=>e.classList.remove(j.cssClass.loading)),this}static handleError(e,t,o,n){return t.error=n,t.view=t.controller+j.pathSeparator+j.errorView,t.path=o.join(j.pathSeparator),O[e].view instanceof q?O[e].view.file=(j.useControllerErrorViews?t.controller+j.pathSeparator:"")+j.errorView:O[e].view.html="Error loading "+t.path,O[e].view.model.clear().sync(t).clearChanges(),O[e][j.errorMethod]()}static sanitizePath(e){for(let t in j.verbose&&console.info("Router.sanitizePath()",{router:this,path:e}),"string"==typeof e&&(e=e.split("/"),e.shift(),e[0]=e[0]||j.defaultController),e)e[t]=(e[t]+"").toLowerCase();return 1==e.length&&e.push(j.defaultMethod),e}static controllerName(e){return j.verbose&&console.info("Router.controllerName()",{router:this,name:e}),a(i(e))+"Controller"}static pushState(e,o={}){location.pathname!=e&&(o.route=e,t(this.state,o),history.pushState(this.state,null,e))}static onClick(t){"A"==t.target.tagName&&t.target.pathname&&(t.preventDefault(),this.navigate(t.target.pathname,Object.assign({},t.target.dataset),t))}static onPopState(t){j.verbose&&console.info("Router.changeState()",{router:this,event:t});let e=location.pathname,o={};t.state&&(e=t.state.route,o=t.state.data),this.navigate(e,o)}// #region Properties
static get controllers(){return this.options.controllers}static set controllers(e){this.options.controllers=e}static get state(){return this.options.state}static set state(e){this.options.state=e}static get view(){return this.options.view instanceof w||(this.view=this.options.view),this.options.view}static set view(e){this.options.view=e instanceof w?e:new q(e)}static get options(){return j}static set options(e){t(j,e)}// #endregion
},e.Store=_,e.StoreErrorDataEmpty=v,e.StoreJsonApi=class extends _{constructor(e){let o={keys:{data:"data",type:"type",id:"id",links:"links",meta:"meta",included:"included",relationships:"relationships"},keysExcludeFromCache:["data","included"],query:{"page[number]":"page[number]","page[size]":"page[size]"},defaultPageSize:0,fetch:{headers:{"Content-Type":"application/vnd.api+json"}},searchDepth:2};t(o,e||{}),super(o),this._mapRelationships={}}sync(e,t,o=!1){if(e[this.options.keys.included]){let o={[this.options.keys.data]:e[this.options.keys.included]};this.sync(o,t,!0)}let n=super.sync(e,t,o);this.mapRelationships(n);try{if(Array.isArray(n)||!(n[this.options.keys.type]&&n[this.options.keys.id]))for(const e in n)n[e].hasOwnProperty(this.options.keys.type)&&n[e].hasOwnProperty(this.options.keys.id)&&this.triggerChangesOnRelated(n[e][this.options.keys.type],n[e][this.options.keys.id]);else this.triggerChangesOnRelated(n[this.options.keys.type],n[this.options.keys.id])}catch(t){}return n}syncPaging(e,t){let o=super.syncPaging(e,t);return o&&o.current&&(o.current[this.options.keys.links]=e[this.options.keys.links],o.current[this.options.keys.meta]=e[this.options.keys.meta]),o}mapRelationships(e){try{if(Array.isArray(e)||!(e[this.options.keys.type]&&e[this.options.keys.id]))for(const t in e)this.mapRelationships(e[t]);else if(e[this.options.keys.relationships]){const t=e[this.options.keys.type],o=e[this.options.keys.id];for(const n in e[this.options.keys.relationships])if(e[this.options.keys.relationships][n][this.options.keys.data])if(Array.isArray(e[this.options.keys.relationships][n][this.options.keys.data]))for(const a in e[this.options.keys.relationships][n][this.options.keys.data]){const i=e[this.options.keys.relationships][n][this.options.keys.data][a][this.options.keys.type],s=e[this.options.keys.relationships][n][this.options.keys.data][a][this.options.keys.id];this.mapRelationship(t,o,i,s)}else{const a=e[this.options.keys.relationships][n][this.options.keys.data][this.options.keys.type],i=e[this.options.keys.relationships][n][this.options.keys.data][this.options.keys.id];this.mapRelationship(t,o,a,i)}}}catch(t){console.error("MAP RELATIONSHIPS",t)}}mapRelationship(e,t,o,n){this._mapRelationships[e]||(this._mapRelationships[e]={}),this._mapRelationships[e][t]||(this._mapRelationships[e][t]={}),this._mapRelationships[e][t][o]||(this._mapRelationships[e][t][o]=[]),-1==this._mapRelationships[e][t][o].indexOf(n)&&this._mapRelationships[e][t][o].push(n),this._mapRelationships[o]||(this._mapRelationships[o]={}),this._mapRelationships[o][n]||(this._mapRelationships[o][n]={}),this._mapRelationships[o][n][e]||(this._mapRelationships[o][n][e]=[]),-1==this._mapRelationships[o][n][e].indexOf(t)&&this._mapRelationships[o][n][e].push(t)}body(e,o){let n=o.id?o.id:this.id(o),a={};return a[this.options.keys.data]={},a[this.options.keys.data][this.options.keys.type]=e,a[this.options.keys.data].attributes={},n&&(a[this.options.keys.data][this.options.keys.id]=n),o[this.options.keys.data]?t(a[this.options.keys.data],o[this.options.keys.data]):o.attributes?t(a[this.options.keys.data],o):t(a[this.options.keys.data].attributes,o),a[this.options.keys.data].attributes[this.options.keys.type]&&delete a[this.options.keys.data].attributes[this.options.keys.type],a[this.options.keys.data].attributes[this.options.keys.id]&&delete a[this.options.keys.data].attributes[this.options.keys.id],super.body(e,a)}triggerChangesOnRelated(e,t){if(!e||!t)return 0;if(!this._mapRelationships[e]||!this._mapRelationships[e][t])return 0;let o=0;for(const n in this._mapRelationships[e][t])for(const a of this._mapRelationships[e][t][n])++o,this._model[n][a].triggerChanges({relationships:{value:{type:e,id:t}}});return o}},e.StoreWordpress=class extends _{constructor(e){let o={baseUrl:"/wp-json/wp/v2",types:{page:"pages",post:"posts",category:"categories",tag:"tags",comment:"comments"},keys:{data:null,type:"type",id:"id"},query:{"page[number]":"page","page[size]":"defaultPageSize"},defaultPageSize:10};t(o,e||{}),super(o)}fetch(e,t,o={}){return"string"==typeof t&&(o.slug=t,t=void 0),super.fetch(e,t,o)}},e.Util=d,e.View=w,e.ViewFile=q,e.ViewHandlebars=P,e}({});