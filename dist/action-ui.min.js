"use strict";var ActionUI=function(a){'use strict';/**
     * Utilities
     */function b(a,c){for(var d in c)c.hasOwnProperty(d)&&(a.hasOwnProperty(d)?a[d]instanceof Object&&c[d]instanceof Object?b(a[d],c[d]):a[d]!=c[d]&&(a[d]=c[d]):a[d]=c[d])}function c(a){return"FORM"==a.tagName?a:a.form}function d(a){return a[0].toUpperCase()+a.substr(1).toLowerCase()}function e(a){return a.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(a,b)=>b.toUpperCase())}function f(a,b){return null==a||a.matches(b)?a:f(a.parentElement,b)}var g=/*#__PURE__*/Object.freeze({__proto__:null,deepAssign:b,requestFromElement:function(a){return new Request(a.action||options.href||null,{method:a.method||null})},form:c,capitalize:d,camelCase:e,firstMatchingParentElement:f}),h=new WeakMap,i=new WeakMap,j=new WeakMap;/**
     * Model
     * @description Observable data object
     */class k{constructor(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};h.set(this,{}),i.set(this,[]),j.set(this,null);var c=new Proxy(this,{get:(a,b)=>"watch"==b||"clearChanges"==b?function(){return a[b].apply(a,arguments)}:Reflect.get(a,b),set:(a,b,c)=>{var d=a[b];return Reflect.set(a,b,c),a._change(a,b,c,d),!0},deleteProperty:(a,b)=>{if(b in a){var c=a[b];delete a[b],a._change(a,b,void 0,c)}return!0}});return b(c,a),c}clear(){for(var a in this)delete this[a];return this}// Sync data object to model
sync(a){return a=Object.assign({},a),b(this,a),this}// Add watcher callback
watch(a){return i.get(this).push(a),this}clearChanges(){return h.set(this,{}),this}// Trigger all watcher callbacks
_trigger(){window.clearTimeout(j.get(this)),j.set(this,null);var a=h.get(this);if(0<Object.keys(a).length){//console.log('changes',changes,this)
var b=i.get(this);for(var c in b)b[c].call(this,a);// Clear change list
h.set(this,{})}}// Log property change
_change(a,b,c,d){h.get(a)[b]={value:c,originalValue:d},j.get(a)||j.set(a,window.setTimeout(()=>a._trigger(),10))}}/**
     * Action UI
     * Allows named handlers to be handled as state-aware deferred promises with before/after events
     */class l{constructor(a,b,c){this.name=a,this.handler=b||((a,b,c)=>a(c)),this.model=c?c:new k,this.running=!1,n.autoCache&&l.cache(this)}// trigger before event and run the handler as a promise 
run(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};n.verbose&&console.info("Action.run()",this.name,{action:this,target:a,data:b}),this.running=!0,a=a||document.body,b=Object.assign(b,l.data(a)),this.before(a,b);var c=null;if(this.handler instanceof Function)c=new Promise((a,c)=>this.handler(a,c,b));else if(this.handler instanceof Request){// If there is data to send, recreate the request with the data
if(0<Object.keys(b).length){var d={};for(var e in this.handler)d[e]=this.handler[e];"POST"==d.method?d.body=JSON.stringify(b):"GET"==d.method&&(d.url+=(0>d.url.indexOf("?")?"?":"&")+Object.keys(b).map(a=>a+"="+b[a]).join("&")),this.handler=new Request(d.url,d)}c=fetch(this.handler).then(a=>a.json())}return c.then(c=>this.after(a,!0,c,b),c=>this.after(a,!1,c,b))}syncModel(a){return n.verbose&&console.info("Action.syncModel()",this.name,{action:this,data:a}),a instanceof Object||(a={result:a}),this.model.sync&&this.model.sync instanceof Function?this.model.sync(a):this.model instanceof Object&&b(this.model,a),a}before(a,b){n.verbose&&console.info("Action.before()",this.name,{action:this,target:a,data:b}),l.setCssClass(a,n.cssClass.loading),l.reflectCssClass(this.name,n.cssClass.loading),Object.assign(n.eventBefore.detail,{name:this.name,data:b,model:this.model}),a.dispatchEvent(n.eventBefore)}after(a,b,c,d){n.verbose&&console.info("Action.after()",this.name,{action:this,target:a,data:d,success:b,result:c}),this.running=!1;//target.removeAttribute('disabled')
var e=b?n.cssClass.success:n.cssClass.fail;return l.setCssClass(a,e),l.reflectCssClass(this.name,e),null!=c&&this.syncModel(c),Object.assign(n.eventAfter.detail,{name:this.name,success:b,data:d,model:this.model}),a.dispatchEvent(n.eventAfter),c}// #region Static methods
// Initialize the action cache and top-level event listener (only once)
static init(){document.addEventListener("click",a=>{var b=f(a.target,"[ui-action]");if(b&&"FORM"!=b.tagName){var c=b.getAttribute("ui-action");// Don't run the action if it's already running
if(c in m)!1==m[c].running&&m[c].run(b);else if(n.autoCreate){// Auto create and run action
var d=l.createFromElement(b);l.cache(d),d.run(b)}else throw new Error("Action not found: "+c)}}),document.addEventListener("submit",a=>{if(a.target.matches("form[ui-action]")){a.preventDefault();var b=a.target.getAttribute("ui-action");// Don't run the action if it's already running
if(b in m)!1==m[b].running&&m[b].run(a.target);else if(n.autoCreate){// Auto create and run action
var c=l.createFromElement(a.target);l.cache(c),c.run(a.target)}else throw new Error("Action not found: "+b)}})}static create(a){if(!1=="name"in a)throw"No action name specfied";return!1=="handler"in a&&(!0=="url"in a&&a.url?a.handler=new Request(a.url,a.request||{}):a.handler=null),new l(a.name,a.handler,a.model)}static createFromElement(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return l.create(Object.assign({name:a.getAttribute("ui-action")||null,url:a.action||b.href||null,request:{method:a.method||null}},b))}// Cache an action 
static cache(a){return"string"==typeof a?m[a]:a.name in m?l:(m[a.name]=a,l)}static data(a){var b=a.dataset||{},d=c(a);return d&&(b=Object.assign(Object.fromEntries(new FormData(d)),b)),b}static get(a){return m[a]}static setCssClass(a,b){for(var c in n.cssClass)a.classList.remove(n.cssClass[c]);a.classList.add(b)}// Propagate class to all reflectors (ui-state and form submit buttons)
static reflectCssClass(a,b){document.querySelectorAll("form[ui-action=\""+a+"\"] [type=\"submit\"], form[ui-action=\""+a+"\"] button:not([type]), [ui-state=\""+a+"\"]").forEach(a=>l.setCssClass(a,b))}static get options(){return n}static set options(a){b(n,a)}// #endregion
}var m={},n={verbose:!1,autoCreate:!0,autoCache:!0,cssClass:{loading:"loading",success:"success",fail:"fail"},eventBefore:new CustomEvent("action.before",{bubbles:!0,detail:{type:"before",name:null,data:null,model:null}}),eventAfter:new CustomEvent("action.after",{bubbles:!0,detail:{type:"after",name:null,data:null,success:null,model:null}})};l.init();/**
     * Controller
     * Provider route mapping for SPAs
     */class o{constructor(a){this.view=a}__autoload(){return this.view.render()}__error(a){return this.view.render()}get view(){return this._view}set view(a){this._view=a}}/**
     * JsonApi
     * @description Json API data store
     * @tutorial var store = new JsonApi('http://localhost:8080/api', ['category', 'product'])
     */ /**
     * View
     * @description Creates a view that will be inserted into elements with
     * ui-view="{{name}}" and updated when its attached model changes
     */class p{constructor(a,b,c){c instanceof k||(c=new k(c||{})),this._name=a,this._html=b,this._model=c,c.watch(a=>this.update(a)),this.constructor.options.autoCache&&p.cache(this)}clear(){return document.querySelectorAll("[ui-view=\""+this._name+"\"]").forEach(a=>{a.innerHTML=""}),this}// When the model updates
update(a){this.constructor.options.verbose&&console.info(this.constructor.name+".update()",this.name,{view:this,changes:a}),this.render()}// Render the model data into the view template for all elements with [ui-view=this.name]
/**
         * Render view to all matching containers
         * @returns Promise
         */render(){return this.constructor.options.verbose&&console.info(this.constructor.name+".render()",this.name,{view:this}),document.querySelectorAll("[ui-view=\""+this._name+"\"]").forEach(a=>{a.innerHTML=this.html,this.renderSubviews(a)}),Object.assign(this.constructor.options.eventRender.detail,{view:this}),document.dispatchEvent(this.constructor.options.eventRender),Promise.resolve()}renderSubviews(a){this.constructor.options.verbose&&console.info(this.constructor.name+".renderSubviews()",this.name,{view:this,parent:a}),a.querySelectorAll("[ui-view]").forEach(a=>{var b=a.getAttribute("ui-view"),c=this.constructor.cache(b);c&&c.render()})}get name(){return this._name}get html(){return this._html instanceof Function?this._html(this._model):this._html}set html(a){this._html=a}get model(){return this._model}// #region Static methods
// View factory
static create(a){return this.options.verbose&&console.info(this.name+":create()",{options:a}),new this(a.name,a.html,a.model)}// Cache a view 
static cache(a){if(this.options.verbose&&console.info(this.name+":cache()",{view:a}),"string"==typeof a)return q[a];if(a instanceof p){if(a.name in q)throw"View name already exists: \""+a.name+"\"";return q[a.name]=a,this}return q}// Render all views
static get options(){return r}static set options(a){b(r,a)}// #endregion
}var q={},r={verbose:!1,autoCache:!0,// Automatically cache views when created
eventRender:new CustomEvent("view.render",{bubbles:!0,detail:{type:"render",view:null}})};/**
     * ViewFile
     * @description View that fetches html from a file
     */class s extends p{constructor(a,b,c){2==arguments.length&&(c=b,b=void 0),b||(b=a),super(a,null,c),this.file=b}clear(){return this.html=null,super.clear()}render(){this.constructor.options.verbose&&console.info(this.constructor.name+".render()",this.name,{view:this});var a=null==this._html?this.fetch():Promise.resolve();return a.then(()=>super.render())}fetch(){return this.constructor.options.verbose&&console.info(this.constructor.name+".fetch()",this.name,{view:this}),fetch(this.fullPath).then(a=>{if(a.ok)return a.text();throw new Error(a.statusText)}).then(a=>this._html=a).catch(()=>{throw new Error("File not found: "+this.fileName)})}get fileName(){return this.file+"."+this.constructor.options.extension}get fullPath(){return this.constructor.options.basePath+this.fileName}get file(){return this._file}set file(a){a!=this._file&&(this._html=null),this._file=a}// #region Static methods
// View factory
static create(a){return this.options.verbose&&console.info(this.name+":create()",{options:a}),a.file&&(a.file=a.name),new this(a.name,a.file,a.model)}static get options(){return t}static set options(a){b(t,a)}// #endregion
}var t={basePath:"view/",extension:"html"};s.options=p.options;/**
     * ViewHandlebars
     * @description View that uses Handlebars templates instead of html
     * @update Support for pre-compiled templates
     */class u extends s{render(){this.constructor.options.verbose&&console.info(this.constructor.name+".render()",this.name,{view:this});var a=null;return null==this._html?Handlebars.templates&&Handlebars.templates[this.file]?(this._html=Handlebars.templates[this.file],a=Promise.resolve()):a=this.fetch().then(()=>this._html=Handlebars.compile(this._html)):a=Promise.resolve(),a.then(()=>super.render())}// #region Static methods
static get options(){return v}static set options(a){b(v,a)}// #endregion
}var v={};u.options=s.options,u.options.extension="hbs";class w{static start(){window.addEventListener("popstate",this.onPopState.bind(this)),y.interceptLinks&&document.addEventListener("click",this.onClick.bind(this)),this.navigate(location.pathname)}static navigate(a){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};y.verbose&&console.info("Router.navigate()",{router:this,route:a,data:c});var d=this.sanitizePath(a),f=d[0],g=d[1],h=this.controllerName(f),i={data:c};this.controllers[h]||(f=y.defaultController,h=this.controllerName(f),g="/"==a?y.defaultMethod:d[0]),x[h]||(this.controllers[h]?x[h]=new this.controllers[h](this.view):x[h]=new o(this.view)),g=g||y.defaultMethod;var j=null,k=f+y.pathSeparator+g,l=e(g);x[h].view instanceof s?x[h].view.file=k:x[h].view instanceof u&&(x[h].view.html=k),y.autoload&&!(x[h][l]instanceof Function)&&(l=y.autoloadMethod),i.dev=location.host==y.devHost,i.view=k,i.controller=f,i.method=g,i.path=Array.from(d);// Query string to object
var m=location.search.substring(1);m&&(m=JSON.parse("{\""+decodeURI(m).replace(/"/g,"\\\"").replace(/&/g,"\",\"").replace(/=/g,"\":\"")+"\"}"),i.search=m);try{var n=Array.from(d);n.shift(),n.shift(),n.push(m),n.push(c),x[h].view.model.clear().sync(i).clearChanges(),j=x[h][l].apply(x[h],n)}catch(a){j=this.handleError(h,i,d)}if(location.pathname!=a&&(b(this.state,{route:a,controller:f,method:g,data:Object.assign({},c),search:m}),history.pushState(this.state,null,a)),j instanceof Promise){var p=document.querySelectorAll("[ui-view=\""+this.view.name+"\"]");this.handleLoading(p,!0),j.then(()=>this.handleLoading(p,!1)).catch(a=>{throw this.handleLoading(p,!1),this.handleError(h,i,d,a),a})}return j}static handleLoading(a,b){return b?a.forEach(a=>a.classList.add(y.cssClass.loading)):a.forEach(a=>a.classList.remove(y.cssClass.loading)),this}static handleError(a,b,c,d){return b.error=d,b.view=b.controller+y.pathSeparator+y.errorView,b.path=c.join(y.pathSeparator),x[a].view instanceof s?x[a].view.file=(y.useControllerErrorViews?b.controller+y.pathSeparator:"")+y.errorView:x[a].view.html="Error loading "+b.path,x[a].view.model.clear().sync(b).clearChanges(),x[a][y.errorMethod]()}static sanitizePath(a){for(var b in y.verbose&&console.info("Router.sanitizePath()",{router:this,path:a}),"string"==typeof a&&(a=a.split("/"),a.shift(),a[0]=a[0]||y.defaultController),a)a[b]=(a[b]+"").toLowerCase();return 1==a.length&&a.push(y.defaultMethod),a}static controllerName(a){return y.verbose&&console.info("Router.controllerName()",{router:this,name:a}),d(e(a))+"Controller"}static onClick(a){"A"==a.target.tagName&&a.target.pathname&&(a.preventDefault(),this.navigate(a.target.pathname,Object.assign({},a.target.dataset)))}static onPopState(a){y.verbose&&console.info("Router.changeState()",{router:this,event:a});var b=location.pathname,c={};a.state&&(b=a.state.route,c=a.state.data),this.navigate(b,c)}// #region Properties
static get controllers(){return this.options.controllers}static set controllers(a){this.options.controllers=a}static get state(){return this.options.state}static set state(a){this.options.state=a}static get view(){return this.options.view instanceof p||(this.view=this.options.view),this.options.view}static set view(a){this.options.view=a instanceof p?a:new s(a)}static get options(){return y}static set options(a){b(y,a)}// #endregion
}var x={},y={controllers:{},view:"controller",state:{},autoload:!0,verbose:!1,cssClass:{loading:"loading",success:"success",fail:"fail"},defaultController:"default",autoloadMethod:"__autoload",defaultMethod:"index",errorMethod:"__error",errorView:"error",useControllerErrorViews:!1,devHost:"localhost",interceptLinks:!0,pathSeparator:"/"};return a.Action=l,a.Controller=o,a.JsonApi=class extends k{constructor(a,b){// Accept an array of store keys
if(b instanceof Array){// Turn them into seperate stores
var c=b;for(var d in b=new k,c)b[c[d]]=new k}b._paging={},super(b),this.baseUrl=a}sync(a){if(!a.hasOwnProperty("data"))throw new Error("JsonApi: No data to sync");if(a.data instanceof Array){var e={};for(var f in a.data)e[a.data[f].id]=this.sync({data:a.data[f]});return e;//this[json.data[0].type]
}var c=a.data.type,d=a.data.id;return this[c]||(this[c]=new k),this[c][d]||(this[c][d]=new k),b(this[c][d],a.data),this[c][d]}fetch(a,b){if(this[a]){if(null!=b&&this[a][b])return Promise.resolve(this[a][b]);if(null==b)return Promise.resolve(this[a])}return fetch(this.baseUrl+"/"+a+(b?"/"+b:"")).then(a=>a.json()).then(a=>this.sync(a))}page(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;if(c=parseInt(c)||0,b=parseInt(b)||1,a in this._paging&&c in this._paging[a]&&b in this._paging[a][c])return Promise.resolve().then(()=>this._paging[a][c][b]);a in this._paging||(this._paging[a]={}),c in this._paging[a]||(this._paging[a][c]={}),b in this._paging[a][c]||(this._paging[a][c][b]=new k({type:a,number:b,size:c,count:0,links:{},model:new k}));var d="?page[number]="+b;return 0<c&&(d+="&page[size]="+c),fetch(this.baseUrl+"/"+a+d).then(a=>a.json()).then(d=>this._paging[a][c][b].sync({links:d.links||{},count:Object.keys(d.data).length,model:this.sync(d)}))}post(a,b){/*
            data = {
                id: '1',
                attributes: {}
            }
            */}},a.Model=k,a.Router=w,a.Util=g,a.View=p,a.ViewFile=s,a.ViewHandlebars=u,a}({});