"use strict";var ActionUI=function(a){"use strict";/**
	 * Utilities
	 */ // Recursively copy source properties to target (Warning: Classes are treated as Objects)
function b(a,c){let d=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2];for(let e in d&&(c=Object.assign(Array.isArray(c)?[]:{},c)),c)c.hasOwnProperty(e)&&(d&&c[e]instanceof Object&&(c[e]=Object.assign(Array.isArray(c[e])?[]:{},c[e])),a.hasOwnProperty(e)?(d&&a[e]instanceof Object&&(a[e]=Object.assign(Array.isArray(a[e])?[]:{},a[e])),a[e]instanceof Object&&c[e]instanceof Object&&!(a[e]instanceof Function||c[e]instanceof Function)?b(a[e],c[e]):a[e]!=c[e]&&(a[e]=c[e])):a[e]=c[e],Array.isArray(a[e])&&Array.isArray(c[e])&&0==c[e].length&&0!=a[e].length&&(a[e]=[]));return a;// For simpler dereference usage
}function c(a,c){return b(a,c,!0)}function d(a){return"FORM"==a.tagName?a:a.form}function e(a){return a[0].toUpperCase()+a.substr(1).toLowerCase()}function f(a){return a.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(a,b)=>b.toUpperCase())}function g(a,b){return null==a||a.matches(b)?a:g(a.parentElement,b)}function h(a){let c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return c=Object.assign(Object.fromEntries(new FormData(a)),c),Object.entries(c).map(a=>{const d=a[0].split("[").map(a=>a.replace(/]/g,""));if(1<d.length){const e=i(d,a[1]);b(c,e),delete c[a[0]]}return a}),c}function i(a,b,c){const d=a.pop();if(!d)return c;let e={};return e[d]=c?c:b,i(a,b,e)}var j=/*#__PURE__*/Object.freeze({__proto__:null,deepAssign:b,deepCopy:c,requestFromElement:function(a){return new Request(a.action||options.href||null,{method:a.method||null})},form:d,capitalize:e,camelCase:f,firstMatchingParentElement:g,formToObject:h});/**
	 * Model
	 * @description Observable data object
	 */class k{constructor(){let a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,c=null;try{c=new Proxy(this,{set:this.constructor._proxySet,deleteProperty:this.constructor._proxyDelete})}catch(a){c=new Proxy(this,{set:this.constructor._proxySet})}// Set private properties
return c._options={triggerDelay:10},c._changes={},c._watchers=[],c._timer=null,c._parent=b,c._loading=!1,c.sync(a),c.clearChanges(),c}clear(){for(let a in this)try{delete this[a]}catch(b){// Fallback for IE11
let c=this[a];this[a]=void 0,this._change(a,void 0,c)}return this}loading(a){return 0==arguments.length?this._loading:void(this._loading=!!a)}// Sync data object to model
sync(a){return a=b({},a,!0),b(this,a),this}// Add watcher callback
watch(a){return this._watchers.push(a),this}clearChanges(){return this._changes={},this}triggerChanges(a){return a&&b(this._changes,a),this._trigger(!0)}// @deprecated
_privatize(){for(let a in this)"_"==a[0]&&Object.defineProperty(this,a,{enumerable:!1})}// Trigger all watcher callbacks
_trigger(){let a=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0];if(window.clearTimeout(this._timer),this._timer=null,a||0<Object.keys(this._changes).length){let a=this._watchers;for(let b in a)a[b].call(this,this._changes);null!=this._parent&&this._parent.model.triggerChanges({child:this,changes:this._changes}),this._changes={}}}// Log property change
_change(a,b,c){this._changes[a]={value:b,originalValue:c},this._timer||(this._timer=window.setTimeout(()=>this._trigger(),this._options.triggerDelay))}static _proxySet(a,b,c){let d=a[b];if(a[b]&&a[b]instanceof k)a[b].sync(c);else if(window.Reflect&&window.Reflect.set)!(c instanceof Object)||Array.isArray(c)||c instanceof k||"_"==b[0]||(c=new k(c,{model:a,property:b})),Reflect.set(a,b,c);else throw"Missing Model dependency: Reflect.set()";return"_"==b[0]?(Object.defineProperty(a,b,{enumerable:!1}),!0):(a._change(b,c,d),!0)}static _proxyDelete(a,b){if(b in a){let c=a[b];delete a[b],a._change(b,void 0,c)}return!0}}/**
	 * Action UI
	 * Allows named handlers to be handled as state-aware deferred promises with before/after events
	 */class l{constructor(a,b,c){this.name=a,this.handler=b||((a,b,c)=>a(c)),this.model=c?c:new k,this.running=!1,o.autoCache&&l.cache(this)}// trigger before event and run the handler as a promise 
run(a){let b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};o.verbose&&console.info("Action.run()",this.name,{action:this,target:a,data:b}),this.running=!0,a=a||document.body,b=Object.assign(b,l.data(a));let c=!this.before(a,b);var d=null;if(c)d=Promise.reject(new m("Canceled"));else if(this.handler instanceof Function)d=new Promise((a,c)=>this.handler(a,c,b));else if(this.handler instanceof Request){// If there is data to send, recreate the request with the data
if(0<Object.keys(b).length){let c={};for(let a in this.handler)c[a]=this.handler[a];if("POST"!=c.method)"GET"==c.method&&(// Append query string to URL with ?/& first as needed
c.url+=(0>c.url.indexOf("?")?"?":"&")+Object.keys(b).map(a=>a+"="+b[a]).join("&"));else if(a.attributes.enctype&&"application/json"==a.attributes.enctype.value)c.body=JSON.stringify(b);else{let a=new FormData;for(let c in b)a.append(c,b[c]);c.body=a}this.handler=new Request(c.url,c)}d=fetch(this.handler).then(a=>a.json().then(b=>a.ok?b:Promise.reject(b)))}return d.then(c=>this.after(a,!0,c,b),c=>this.after(a,!1,c,b))}syncModel(a){return a=b({},a,!0),o.verbose&&console.info("Action.syncModel()",this.name,{action:this,data:a}),a instanceof Object||(a={result:a}),this.model.sync&&this.model.sync instanceof Function?this.model.sync(a):this.model instanceof Object&&b(this.model,a),a}before(a,b){o.verbose&&console.info("Action.before()",this.name,{action:this,target:a,data:b}),l.setCssClass(a,o.cssClass.loading),l.reflectCssClass(this.name,o.cssClass.loading);let c=new CustomEvent(o.eventBefore.type,o.eventBefore);return Object.assign(c.detail,{name:this.name,data:b,model:this.model}),a.dispatchEvent(c)}after(a,b,c,d){o.verbose&&console.info("Action.after()",this.name,{action:this,target:a,data:d,success:b,result:c}),this.running=!1;var e=c instanceof m,f=b?o.cssClass.success:o.cssClass.fail;e&&(f=o.cssClass.canceled),l.setCssClass(a,f),l.reflectCssClass(this.name,f),null==c||c instanceof Error||this.syncModel(c);let g=new CustomEvent(o.eventAfter.type,o.eventAfter);return Object.assign(g.detail,{name:this.name,success:b,data:d,model:this.model,error:!!(c instanceof Error)&&c,canceled:e}),a.dispatchEvent(g),c}// #region Static methods
// Initialize the action cache and top-level event listener (only once)
static init(){document.addEventListener("click",a=>{let b=g(a.target,"[ui-action]");if(b&&"FORM"!=b.tagName&&!b.disabled&&!a.target.disabled){"INPUT"==b.tagName&&("checkbox"==b.type||"radio"==b.type)||a.preventDefault();var c=b.getAttribute("ui-action");// Don't run the action if it's already running
if(c in n)!1==n[c].running&&n[c].run(b);else if(o.autoCreate){// Auto create and run action
var d=l.createFromElement(b);l.cache(d),d.run(b)}else throw new Error("Action not found: "+c)}}),document.addEventListener("submit",a=>{if(a.target.matches("form[ui-action]")&&!a.target.disabled){a.preventDefault();var b=a.target.getAttribute("ui-action");// Don't run the action if it's already running
if(b in n)!1==n[b].running&&n[b].run(a.target);else if(o.autoCreate){// Auto create and run action
var c=l.createFromElement(a.target);l.cache(c),c.run(a.target)}else throw new Error("Action not found: "+b)}})}static create(a){let b=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(o.verbose&&console.info(this.name+":create()",{options:a,fromCache:b}),!1=="name"in a)throw"No action name specfied";return!1=="handler"in a&&(!0=="url"in a&&a.url?a.handler=new Request(a.url,a.request||{}):a.handler=null),b?this.cache(a.name)||new this(a.name,a.handler,a.model):new this(a.name,a.handler,a.model)}static createFromElement(a){let b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return l.create(Object.assign({name:a.getAttribute("ui-action")||null,url:a.action||a.href||b.href||null,request:{method:a.method||b.method||"GET"}},b))}// Cache an action 
static cache(a){return null==a?n:"string"==typeof a?n[a]:a.name in n?this:(n[a.name]=a,this)}static data(a){var b=a.dataset||{},c=d(a);return c&&(b=h(c,b)),b}static get(a){return n[a]}static setCssClass(a,b){for(var c in o.cssClass)a.classList.remove(o.cssClass[c]);a.classList.add(b)}// Propagate class to all reflectors (ui-state and form submit buttons)
static reflectCssClass(a,b){document.querySelectorAll("form[ui-action=\""+a+"\"] [type=\"submit\"], form[ui-action=\""+a+"\"] button:not([type]), [ui-state=\""+a+"\"]").forEach(a=>l.setCssClass(a,b))}static get options(){return o}static set options(a){b(o,a)}// #endregion
}class m extends Error{}let n={},o={verbose:!1,autoCreate:!0,autoCache:!0,cssClass:{loading:"loading",success:"success",fail:"fail",canceled:"canceled"},eventBefore:new CustomEvent("action.before",{bubbles:!0,cancelable:!0,detail:{type:"before",name:null,data:null,model:null}}),eventAfter:new CustomEvent("action.after",{bubbles:!0,cancelable:!0,detail:{type:"after",name:null,data:null,success:null,model:null}})};l.init();/**
	 * Controller
	 * Provider route mapping for SPAs
	 */class p{constructor(a){this.view=a}__autoload(){return this.view.render()}__error(){return this.view.render()}get view(){return this._view}set view(a){this._view=a}}/**
	 * JsonApi
	 * @description Json API data store
	 * @tutorial var store = new JsonApi('http://localhost:8080/api', ['category', 'product'])
	 */ /**
	 * Store
	 * @version 20230126
	 * @description Remote data store
	 * @tutorial let store = new Store({baseUrl:'http://localhost:8080/api', types:['category', 'product']})
	 */class q{constructor(a){// Accept an array of store keys
if(this.options={baseUrl:null,types:null,keys:{data:null,type:"type",id:"id"},keysExcludeFromCache:[],defaultPageSize:0,query:{"page[number]":"page[number]","page[size]":"page[size]"},fetch:{method:"GET",headers:{"Content-Type":"application/json"},mode:"no-cors"},searchDepth:1,triggerChangesOnError:!0,// Allows views to update contents on failed requests, especially useful for Fetch All requests which return no results or 404
triggerChangesOnEmpty:!0,useUrlCache:!0,verbose:!1,viewClass:null,viewMap:{},actionVerb:{get:"fetch",post:"create",patch:"update",delete:"delete"},actionHandler:{get:this.actionHandler,post:this.actionHandler,patch:this.actionHandler,delete:this.actionHandler},eventBefore:new CustomEvent("store.before",{bubbles:!0,cancelable:!0,detail:{type:"before",name:null,fetch:null,data:null,model:null,view:null,query:null}}),eventAfter:new CustomEvent("store.after",{bubbles:!0,detail:{type:"after",name:null,fetch:null,data:null,model:null,view:null,success:null,response:null,json:null,query:null}})},b(this.options,a||{}),this._model=new k,this._urlCache={},this._model._paging={},this.options.types instanceof Array){let a={};// Turn them into seperate stores
for(let b in this.options.types)a[this.options.types[b]]=this.options.types[b];this.options.types=a}if(this.options.types instanceof Object)for(let a in this.options.types)this.modelCreate(this.options.types[a]);q.cache(this)}body(a,b){return JSON.stringify(b)}model(a,b){return b?this._model[a][b]:this._model[a]}modelCreate(a){let b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if("string"!=typeof a)throw new Error("Store: Cannot create model without `type`");if(!this._model[a]&&(this._model[a]=new k({_type:a},{model:this._model,property:a}),this.actionCreate(a,"get"),this.actionCreate(a,"post"),this.actionCreate(a,"patch"),this.actionCreate(a,"delete"),this.options.viewClass&&this.options.viewMap.hasOwnProperty(a)))if(Array.isArray(this.options.viewMap[a]))for(let b of this.options.viewMap[a])this.options.viewClass.create({name:b,file:b,model:this._model[a]});else{let b=this.options.viewMap[a];this.options.viewClass.create({name:b,file:b,model:this._model[a]})}return null==b||"string"!=typeof b&&"number"!=typeof b||this._model[a][b]||(this._model[a][b]=new k({_type:a},{model:this._model[a],property:b})),b?this._model[a][b]:this._model[a]}actionCreate(a,b){b=b.toLowerCase();var c=a+" "+this.options.actionVerb[b],d=this.options.actionHandler[b].bind(this,a,b),e=new l(c,d);return l.cache(e),e}actionHandler(a,b,c,d,e){let f=null;return"get"===b?f=this.fetch(a,e.id):"post"===b?f=this.post(a,e):"patch"===b?f=this.patch(a,e):"delete"===b?f=this.delete(a,e.id):void 0,f.then(a=>c(a)).catch(a=>d(a))}data(a){return this.options.keys.data?a[this.options.keys.data]:a}type(a){let b=a[this.options.keys.type];return this.options.types[b]&&(b=this.options.types[b]),b}id(a){return a[this.options.keys.id]}sync(a,b){let c=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],d=this.data(a);if(!d||0==Object.keys(d).length)throw c||this.syncPaging(a,b),new Error("Store: No data to sync");if(d instanceof Array){let e={};for(let a in d){let c=null;this.options.keys.data?(c={},c[this.options.keys.data]=d[a]):c=d[a],e[this.id(d[a])]=this.sync(c,b)}return c||this.syncPaging(a,b),e}let e=this.type(d),f=this.id(d);if(this._model[e]||this.modelCreate(e),this._model[e][f]||this.modelCreate(e,f),!this._model[e][f])throw new Error("Store: No model for type: "+e+", id: "+f);return this._model[e][f].sync(d),b&&(!this._model[e][f].hasOwnProperty("_store")&&(this._model[e][f]._store={url:[]}),-1==this._model[e][f]._store.url.indexOf(b)&&this._model[e][f]._store.url.push(b),b=this.url({type:e,id:f}),-1==this._model[e][f]._store.url.indexOf(b)&&this._model[e][f]._store.url.push(b)),this._model[e][f]}syncPaging(a,b){let d=this.pageData(b);// Paging
if(d.type&&d.pageSize&&d.pageNumber){let e=this.pageKey(d.pageSize,d.query),f=this.data(a);if(Array.isArray(f)){let a=this.model(d.type),g=[],h=c({},d);for(let a of f)g.push({id:a[this.options.keys.id],type:a[this.options.keys.type]});h.data=g,h.url=[b],a._paging||(a._paging=new k({current:null,type:d.type,pageNumber:d.pageNumber,pageSize:d.pageSize,pageKey:e},{model:a,property:"_paging"})),a._paging[e]||(a._paging[e]=new k({},{model:a._paging,property:e})),a._paging[e][d.pageNumber]||(a._paging[e][d.pageNumber]=new k({},{model:a._paging[e],property:d.pageNumber})),a._paging[e][d.pageNumber].sync(h)}return this.pageChange(d.type,d.pageNumber,d.pageSize,d.query)}}url(a){let b=this.options.types[a.type]||a.type,c=this.options.baseUrl+"/"+b+"/"+(a.id?a.id+"/":""),d=new URLSearchParams;for(let b in a)b in this.options.query?d.set(this.options.query[b],a[b]):"type"!=b&&"id"!=b&&d.set(b,a[b]);d.sort();let e=d.toString();return e&&(c+="?"+e),c}urlParse(a){if(!a)return{url:null,type:null,pageNumber:!1,pageSize:!1};-1==a.indexOf("://")&&(0<a.indexOf("/")&&(a="/"+a),a=location.origin+a);let b=this.options.baseUrl;-1==b.indexOf("://")&&(0<b.indexOf("/")&&(b="/"+b),b=location.origin+b);let c=new URL(a),d=new URL(b),e=c.pathname.replace(d.pathname,"").split("/"),f=e[0]||e[1];c.searchParams.sort();let g={};return c.searchParams.forEach((a,b)=>g[b]=a),{url:c,type:f,pageNumber:parseInt(c.searchParams.get(this.options.query["page[number]"])),pageSize:parseInt(c.searchParams.get(this.options.query["page[size]"])),query:g}}search(a){let b=new k;for(let c in this._model)if(!(0==c.indexOf("_")||a.type&&this.type({type:a.type})!=c))for(let d in this._model[c]){let e=!1,f=this._model[c][d];for(let b in a)e=this.propertyValueExists(f,b,a[b],this.options.searchDepth);e&&(b[d]=f)}return b}propertyValueExists(a,b,c){let d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;var e=Object.keys(a);if(-1<e.indexOf(b))return a[b]==c;if(1>=d)return!1;for(let f of e)if("object"==typeof a[f])return this.propertyValueExists(a[f],b,c,d-1)}async fetch(a,b){let c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};a=this.type({type:a}),c=c||{},b=b||void 0,"object"==typeof b&&(c=b,b=c.id);let d=this.url(Object.assign({},c,{type:a,id:b}));return this.options.verbose&&console.info("Store.fetch()",a,b,{type:a,id:b,query:c,store:this,url:d,options:this.options.fetch}),this.fetchUrl(d,a,c)}async fetchUrl(a,b){let c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(!a)return Promise.reject();try{c=c||{},c.type=b;let d=this.urlParse(a).url.toString(),e=this.urlCache(d);if(b=c.type||(e?e.type:null)||d.type||null,e)return this.pageChange(e.type,e.pageNumber,e.pageSize,e.pageData.query),Promise.resolve(e.model);this.before(b,this.options.fetch,c);const f=await fetch(a,this.options.fetch);let g=!0==f.ok?await f.json():{};if(this.after(b,this.options.fetch,c,!!f&&f.ok,f,g),!f.ok)return b&&this.options.triggerChangesOnError&&this._model[b]&&this.model(b).triggerChanges(),Promise.reject(g);try{let b=this.sync(g,a);return this.urlCache(d,b,g),b}catch(a){return b&&this.options.triggerChangesOnError&&this._model[b]&&this.model(b).triggerChanges(),Promise.reject(g)}}catch(a){return b&&this.options.triggerChangesOnError&&this._model[b]&&this.model(b).triggerChanges(),await Promise.reject(a)}}urlCache(a){let b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!this.options.useUrlCache)return!1;if(a=decodeURIComponent(a),!b&&!c)return this._urlCache[a];let d=this.pageData(a),e=b[this.options.keys.type]||b._type||(d?d.type:null);if(c)for(let a of this.options.keysExcludeFromCache)delete c[a];return this._urlCache[a]={url:a,type:e,model:b,json:c,pageData:d,pageNumber:!!d&&d.pageNumber,pageSize:!!d&&d.pageSize}}urlCacheClear(a){let b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];if(!a)return void(this._urlCache={});let c=Object.keys(this._urlCache);for(var d of c)this._urlCache[d].type==a&&(!b||this._urlCache[d].pageNumber&&this._urlCache[d].pageSize)&&delete this._urlCache[d]}pageData(a){if(!a)return{type:null,pageNumber:!1,pageSize:!1};let b=this.urlParse(a),c=this._urlCache[a],d=b.pageSize||!!c&&c.pageSize,e=b.query||(c?c.query:{});return{type:b.type||(c?c.type:null),pageNumber:b.pageNumber||!!c&&c.pageNumber,pageSize:d,pageKey:this.pageKey(d,e),query:e,cached:!!c}}paging(a){return this.model(a)._paging||{current:!1,pageNumber:!1,pageSize:!1,pageKey:!1}}async pagingReset(a){this.urlCacheClear(a,!0);let b=!1,c=!1,d=!1;return this._model[a]._paging&&(this._model[a]._paging.current&&(b=this._model[a]._paging.current.pageNumber,c=this._model[a]._paging.current.pageSize,d=this._model[a]._paging.current.query,1>=this._model[a]._paging.current.data.length&&1<b&&--b),delete this._model[a]._paging),b&&c?this.page(a,b,c,d):Promise.resolve()}async page(a){let b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return d=d||{},c=parseInt(c)||this.options.defaultPageSize,b=parseInt(b)||1,d.type=a,d[this.options.query["page[number]"]]=b,d[this.options.query["page[size]"]]=c,await this.fetch(a,0,d)}pageChange(a,b,c){let d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},e=this.pageKey(c,d);return!!(a&&e&&b&&c&&this._model[a]._paging&&this._model[a]._paging[e][b])&&(this._model[a]._paging.pageNumber=b,this._model[a]._paging.pageSize=c,this._model[a]._paging.pageKey=e,delete this._model[a]._paging.current,this._model[a]._paging.current=this._model[a]._paging[e][b],this._model[a]._paging)}pageKey(a){let b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};b[this.options.query["page[size]"]]=a,delete b[this.options.query["page[number]"]];let c=new URLSearchParams(b);return c.sort(),c.toString()}post(a,b){let d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};a=a||this.type(b);let e={};c(e,this.options.fetch),e.method="POST",e.body=this.body(a,b),this.before(a,e,b,d);let f=this.url(Object.assign({},d,{type:a,id:this.id(b)}));return this.options.verbose&&console.info("Store.post()",a,{type:a,data:b,query:d,store:this,url:f,options:e}),fetch(f,e).then(c=>c.ok?c.json().then(f=>(this.after(a,e,b,!!c&&c.ok,c,f,d),f)):Promise.reject(json)).then(a=>this.sync(a,f)).catch(b=>(this.options.triggerChangesOnError&&this.model(a).triggerChanges(),Promise.reject(b)))}patch(a,b){let d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};a=a||this.type(b);let e={};c(e,this.options.fetch),e.method="PATCH",e.body=this.body(a,b),this.before(a,e,b,d);let f=this.url(Object.assign({},d,{type:a,id:this.id(b)}));return this.options.verbose&&console.info("Store.patch()",a,{type:a,data:b,query:d,store:this,url:f,options:e}),fetch(f,e).then(c=>c.ok?c.json().then(f=>(this.after(a,e,b,!!c&&c.ok,c,f,d),f)):Promise.reject(json)).then(a=>this.sync(a,f)).catch(b=>(this.options.triggerChangesOnError&&this.model(a).triggerChanges(),Promise.reject(b)))}delete(a,b){let d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},e={};e[this.options.keys.id]=b;let f={};c(f,this.options.fetch),f.method="DELETE",this.before(a,f,e,d);let g=this.url(Object.assign({},d,{type:a,id:e.id}));return this.options.verbose&&console.info("Store.delete()",a,b,{type:a,id:e.id,query:d,store:this,url:g,options:f}),fetch(g,f).then(b=>b.ok?b.json().then(c=>(this.after(a,f,e,!!b&&b.ok,b,c,d),c)):Promise.reject(json)).then(c=>(delete this._model[a][b],c)).then(()=>this.pagingReset(a).catch(()=>{})).catch(b=>(this.options.triggerChangesOnError&&this.model(a).triggerChanges(),Promise.reject(b)))}loading(a,b){this._model[a]||this.modelCreate(a);const c=this.model(a);return 1==arguments.length?c.loading():void c.loading(b)}before(a,b,c){let d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,e=this.options.baseUrl+"/"+a,f=null;this.loading(a,!0),this.options.viewClass&&this.options.viewMap.hasOwnProperty(a)&&(f=this.options.viewClass.cache(this.options.viewMap[a])),this.options.verbose&&console.info("Store.before()",e,{store:this,type:a,fetch:b,data:c,view:f,model:this.model(a),query:d}),f&&document.querySelectorAll("[ui-view=\""+f.name+"\"]").forEach(a=>{this.options.viewClass.setCssClass(a,this.options.viewClass.options.cssClass.loading)});let g=new CustomEvent(this.options.eventBefore.type,this.options.eventBefore);return Object.assign(g.detail,{name:e,fetch:b,store:this,data:c,model:this.model(a),view:f,query:d}),document.dispatchEvent(g)}after(a,b,c,d,e,f){let g=6<arguments.length&&void 0!==arguments[6]?arguments[6]:null,h=this.options.baseUrl+"/"+a,i=null;this.loading(a,!1),this.options.viewClass&&this.options.viewMap.hasOwnProperty(a)&&(i=this.options.viewClass.cache(this.options.viewMap[a])),this.options.verbose&&console.info("Store.after()",h,{store:this,type:a,fetch:b,data:c,view:i,model:this.model(a),success:d,response:e,json:f,query:g}),i&&document.querySelectorAll("[ui-view=\""+i.name+"\"]").forEach(a=>{this.options.viewClass.setCssClass(a,d?this.options.viewClass.options.cssClass.success:this.options.viewClass.options.cssClass.fail)});let j=new CustomEvent(this.options.eventAfter.type,this.options.eventAfter);return Object.assign(j.detail,{name:h,success:d,fetch:b,store:this,data:c,model:this.model(a),view:i,response:e,json:f,query:g}),document.dispatchEvent(j)}static cache(a){if(null==a)return r;if("string"==typeof a){if(a=a.toLowerCase(),null!=r[a])return r[a];// Find a store that starts with the requested url to match ('/api/v1/entity' with a '/api/v1' store)
for(var b in r)if(b.startsWith(a))return r[b];return}var c=a.options.baseUrl.toLowerCase();return c in r?this:(r[c]=a,this)}}let r={};/**
	 * View
	 * @description Creates a view that will be inserted into elements with
	 * ui-view="{{name}}" and updated when its attached model changes
	 */class s{constructor(a,b,c){c instanceof k||(c=new k(c||{controller:null,data:{},dev:!1,error:null,method:null,path:null,view:null})),this._name=a,this._html=b,this._model=c,c.watch(a=>this.update(a)),this.constructor.options.autoCache&&s.cache(this)}clear(){return document.querySelectorAll("[ui-view=\""+this._name+"\"]").forEach(a=>{a.innerHTML=""}),this}// When the model updates
update(a){this.constructor.options.verbose&&console.info(this.constructor.name+".update()",this.name,{view:this,changes:a}),this.render()}// Render the model data into the view template for all elements with [ui-view=this.name]
/**
	     * Render view to all matching containers
	     * @returns Promise
	     */render(){this.constructor.options.verbose&&console.info(this.constructor.name+".render()",this.name,{view:this});let a=new CustomEvent(this.constructor.options.eventRender.type,this.constructor.options.eventRender),b=new CustomEvent(this.constructor.options.eventRenderBefore.type,this.constructor.options.eventRenderBefore);return Object.assign(b.detail,{name:this.model.view,view:this}),Object.assign(a.detail,{name:this.model.view,view:this}),document.querySelectorAll("[ui-view=\""+this._name+"\"]").forEach(c=>{let d=!c.dispatchEvent(b);d||(c.innerHTML=a.detail.view.html,c.dispatchEvent(a),this.renderSubviews(c))}),Promise.resolve()}renderSubviews(a){this.constructor.options.verbose&&console.info(this.constructor.name+".renderSubviews()",this.name,{view:this,parent:a}),a.querySelectorAll("[ui-view]").forEach(a=>{let b=a.getAttribute("ui-view"),c=this.constructor.cache(b);c&&c.render()})}get name(){return this._name}get html(){return this._html instanceof Function?this._html(this._model):this._html}set html(a){this._html=a}get model(){return this._model}// #region Static methods
// View factory
static create(a){let b=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return this.options.verbose&&console.info(this.name+":create()",{options:a,fromCache:b}),b&&a.name?this.cache(a.name)||new this(a.name,a.html,a.model):new this(a.name,a.html,a.model)}// Cache a view 
static cache(a){if(this.options.verbose&&console.info(this.name+":cache()",{view:a}),"string"==typeof a)return t[a];if(a instanceof s){if(a.name in t)throw"View name already exists: \""+a.name+"\"";return t[a.name]=a,this}return t}// Render all views
static get options(){return u}static set options(a){b(u,a)}// #endregion
}let t={},u={verbose:!1,autoCache:!0,// Automatically cache views when created
eventRenderBefore:new CustomEvent("view.render.before",{bubbles:!0,cancelable:!0,detail:{type:"render.before",name:null,view:null}}),eventRender:new CustomEvent("view.render",{bubbles:!0,cancelable:!0,detail:{type:"render",name:null,view:null}})};/**
	 * ViewFile
	 * @description View that fetches html from a file
	 */class v extends s{constructor(a,b,c){2==arguments.length&&(c=b,b=void 0),b||(b=a),super(a,null,c),this.file=b}clear(){return this.html=null,super.clear()}render(){this.constructor.options.verbose&&console.info(this.constructor.name+".render()",this.name,{view:this});var a=null==this._html?this.fetch():Promise.resolve();return a.then(()=>super.render())}fetch(){return this.constructor.options.verbose&&console.info(this.constructor.name+".fetch()",this.name,{view:this}),this.fetchBefore(),fetch(this.fullPath).then(a=>{if(a.ok)return a.text();throw new Error(a.statusText)}).then(a=>(this._html=a,this.fetchAfter(!0),this._html)).catch(()=>{throw this.fetchAfter(!1),new Error("File not found: "+this.fileName)})}fetchBefore(){this.constructor.options.verbose&&console.info(this.constructor.name+".fetchBefore()",this.name,{view:this}),document.querySelectorAll("[ui-view=\""+this._name+"\"]").forEach(a=>{this.constructor.setCssClass(a,w.cssClass.loading)}),this.constructor.options.eventFetch&&(Object.assign(this.constructor.options.eventFetch.detail,{view:this,success:null}),document.dispatchEvent(this.constructor.options.eventFetch))}fetchAfter(a){this.constructor.options.verbose&&console.info(this.constructor.name+".fetchAfter()",this.name,{view:this}),document.querySelectorAll("[ui-view=\""+this._name+"\"]").forEach(b=>{this.constructor.setCssClass(b,a?w.cssClass.success:w.cssClass.fail)}),this.constructor.options.eventFetch&&(Object.assign(this.constructor.options.eventFetch.detail,{view:this,success:a}),document.dispatchEvent(this.constructor.options.eventFetch))}get fileName(){return this.file+"."+this.constructor.options.extension}get fullPath(){return this.constructor.options.basePath+this.fileName}get file(){return this._file}set file(a){a!=this._file&&(this._html=null),this._file=a}// #region Static methods
// View factory
static create(a){let b=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return this.options.verbose&&console.info(this.name+":create()",{options:a,fromCache:b}),a.file||(a.file=a.name),b&&a.name?this.cache(a.name)||new this(a.name,a.file,a.model):new this(a.name,a.file,a.model)}static setCssClass(a,b){for(var c in w.cssClass)a.classList.remove(w.cssClass[c]);a.classList.add(b)}static get options(){return w}static set options(a){b(w,a)}// #endregion
}let w={basePath:"view/",extension:"html",cssClass:{loading:"loading",success:"success",fail:"fail"},eventFetch:new CustomEvent("view.fetch",{bubbles:!0,detail:{type:"fetch",view:null,success:null}}),eventRender:new CustomEvent("view.render",{bubbles:!0,cancelable:!0,detail:{type:"render",view:null}})};v.options=s.options;/**
	 * ViewHandlebars
	 * @description View that uses Handlebars templates instead of html
	 * @update Support for pre-compiled templates
	 */class x extends v{render(){this.constructor.options.verbose&&console.info(this.constructor.name+".render()",this.name,{view:this});var a=Promise.resolve();return null==this.html&&Handlebars.templates&&Handlebars.templates[this.file]&&(this.html=Handlebars.templates[this.file]),a.then(()=>super.render())}fetch(){return super.fetch().then(a=>("templates"in Handlebars||(Handlebars.templates=[]),Handlebars.templates[this.file]=Handlebars.compile(a),this.html=Handlebars.templates[this.file],a))}// #region Static methods
static get options(){return y}static set options(a){b(y,a)}// #endregion
}let y={};x.options=v.options,x.options.extension="hbs";let z={},A={controllers:{},view:"controller",state:{},autoload:!0,verbose:!1,cssClass:{loading:"loading",success:"success",fail:"fail"},defaultController:"default",autoloadMethod:"__autoload",defaultMethod:"index",errorMethod:"__error",errorView:"error",useControllerErrorViews:!1,devHost:"localhost",interceptLinks:!0,pathSeparator:"/",routes:{}};return a.Action=l,a.ActionErrorCanceled=m,a.Controller=p,a.JsonApi=class extends k{constructor(a,b){// Accept an array of store keys
if(b instanceof Array){// Turn them into seperate stores
let a=b;for(let c in b=new k,a)b[a[c]]=new k}b._paging={},super(b),this.baseUrl=a}sync(a){if(!a.hasOwnProperty("data"))throw new Error("JsonApi: No data to sync");if(a.data instanceof Array){let b={};for(let c in a.data)b[a.data[c].id]=this.sync({data:a.data[c]});return b;//this[json.data[0].type]
}let c=a.data.type,d=a.data.id;return this[c]||(this[c]=new k),this[c][d]||(this[c][d]=new k),b(this[c][d],a.data),this[c][d]}fetch(a,b){if(this[a]){if(null!=b&&this[a][b])return Promise.resolve(this[a][b]);if(null==b)return Promise.resolve(this[a])}return fetch(this.baseUrl+"/"+a+(b?"/"+b:"")).then(a=>a.json()).then(a=>this.sync(a))}page(a){let b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;if(c=parseInt(c)||0,b=parseInt(b)||1,a in this._paging&&c in this._paging[a]&&b in this._paging[a][c])return Promise.resolve().then(()=>this._paging[a][c][b]);a in this._paging||(this._paging[a]={}),c in this._paging[a]||(this._paging[a][c]={}),b in this._paging[a][c]||(this._paging[a][c][b]=new k({type:a,number:b,size:c,count:0,links:{},model:new k}));let d="?page[number]="+b;return 0<c&&(d+="&page[size]="+c),fetch(this.baseUrl+"/"+a+d).then(a=>a.json()).then(d=>this._paging[a][c][b].sync({links:d.links||{},count:Object.keys(d.data).length,model:this.sync(d)}))}post(){/*
	        data = {
	            id: '1',
	            attributes: {}
	        }
	        */}},a.Model=k,a.Router=class{static start(){window.addEventListener("popstate",this.onPopState.bind(this)),A.interceptLinks&&document.addEventListener("click",this.onClick.bind(this)),this.navigate(location.pathname)}static route(a,b){let c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;this.options.routes[a]={route:a,callback:b,priority:c}}static match(a){let b=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];// Exact match
if(this.options.routes[a])return b&&"string"==typeof this.options.routes[a].callback?this.match(this.options.routes[a].callback):this.options.routes[a];let c=null;for(let b in Object.keys(this.options.routes))null!=a.match(b)&&(null==c||this.options.routes[b].priority<=c.priority)&&(c=this.options.routes[b]);// If route is a forward
return c&&b&&"string"==typeof c.callback&&(c=this.match(c.callback)),c}static navigate(a){let b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;A.verbose&&console.info("Router.navigate()",{router:this,route:a,data:b});let d=this.sanitizePath(a),g=d[0],h=d[1],i=this.controllerName(g),j={data:b},k=this.match(a,!1);if(k&&"string"==typeof k.callback)// Redirect
return this.navigate(k.callback,b,c);this.controllers[i]||(g=A.defaultController,i=this.controllerName(g),h="/"==a?A.defaultMethod:d[0]),z[i]||(this.controllers[i]?z[i]=new this.controllers[i](this.view):z[i]=new p(this.view)),h=h||A.defaultMethod;let m=null,n=g+A.pathSeparator+h,o=f(h);z[i].view instanceof v?z[i].view.file=n:z[i].view instanceof x&&(z[i].view.html=n),A.autoload&&!(z[i][o]instanceof Function)&&(o=A.autoloadMethod),j.dev=location.host==A.devHost,j.view=n,j.controller=g,j.method=h,j.path=Array.from(d),j.event=c;// Query string to object
let q=location.search.substring(1);q&&(q=JSON.parse("{\""+decodeURI(q).replace(/"/g,"\\\"").replace(/&/g,"\",\"").replace(/=/g,"\":\"")+"\"}"),j.search=q);try{let e=Array.from(d);if(e.shift(),e.shift(),e.push(q),e.push(b),!k)z[i].view.model.clear().sync(j).clearChanges(),m=z[i][o].apply(z[i],e),this.pushState(a,{controller:g,method:h,data:Object.assign({},b),search:q});else if(k.callback instanceof l){k.callback.model.clear().sync(j).clearChanges();let a=c?c.target:document;m=k.callback.run(a,b)}else e.push(j),m=k.callback.apply(z[i],e)}catch(c){this.options.verbose&&console.error("Routing Error",c),this.pushState(a,{controller:g,method:h,data:Object.assign({},b),search:q}),m=this.handleError(i,j,d)}if(m instanceof Promise){let a=document.querySelectorAll("[ui-view=\""+this.view.name+"\"]");this.handleLoading(a,!0),m.then(()=>this.handleLoading(a,!1)).catch(b=>{throw this.handleLoading(a,!1),this.handleError(i,j,d,b),b})}return m}static handleLoading(a,b){return b?a.forEach(a=>a.classList.add(A.cssClass.loading)):a.forEach(a=>a.classList.remove(A.cssClass.loading)),this}static handleError(a,b,c,d){return b.error=d,b.view=b.controller+A.pathSeparator+A.errorView,b.path=c.join(A.pathSeparator),z[a].view instanceof v?z[a].view.file=(A.useControllerErrorViews?b.controller+A.pathSeparator:"")+A.errorView:z[a].view.html="Error loading "+b.path,z[a].view.model.clear().sync(b).clearChanges(),z[a][A.errorMethod]()}static sanitizePath(a){for(let b in A.verbose&&console.info("Router.sanitizePath()",{router:this,path:a}),"string"==typeof a&&(a=a.split("/"),a.shift(),a[0]=a[0]||A.defaultController),a)a[b]=(a[b]+"").toLowerCase();return 1==a.length&&a.push(A.defaultMethod),a}static controllerName(a){return A.verbose&&console.info("Router.controllerName()",{router:this,name:a}),e(f(a))+"Controller"}static pushState(a){let c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};location.pathname!=a&&(c.route=a,b(this.state,c),history.pushState(this.state,null,a))}static onClick(a){"A"==a.target.tagName&&a.target.pathname&&(a.preventDefault(),this.navigate(a.target.pathname,Object.assign({},a.target.dataset),a))}static onPopState(a){A.verbose&&console.info("Router.changeState()",{router:this,event:a});let b=location.pathname,c={};a.state&&(b=a.state.route,c=a.state.data),this.navigate(b,c)}// #region Properties
static get controllers(){return this.options.controllers}static set controllers(a){this.options.controllers=a}static get state(){return this.options.state}static set state(a){this.options.state=a}static get view(){return this.options.view instanceof s||(this.view=this.options.view),this.options.view}static set view(a){this.options.view=a instanceof s?a:new v(a)}static get options(){return A}static set options(a){b(A,a)}// #endregion
},a.Store=q,a.StoreJsonApi=class extends q{constructor(a){let c={keys:{data:"data",type:"type",id:"id",links:"links",meta:"meta",included:"included",relationships:"relationships"},keysExcludeFromCache:["data","included"],query:{"page[number]":"page[number]","page[size]":"page[size]"},defaultPageSize:0,fetch:{headers:{"Content-Type":"application/vnd.api+json"}},searchDepth:2};b(c,a||{}),super(c),this._mapRelationships={}}sync(a,b){let c=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2];if(a[this.options.keys.included]){let c={[this.options.keys.data]:a[this.options.keys.included]};this.sync(c,b,!0)}let d=super.sync(a,b,c);this.mapRelationships(d);try{if(Array.isArray(d)||!(d[this.options.keys.type]&&d[this.options.keys.id]))for(const a in d)d[a].hasOwnProperty(this.options.keys.type)&&d[a].hasOwnProperty(this.options.keys.id)&&this.triggerChangesOnRelated(d[a][this.options.keys.type],d[a][this.options.keys.id]);else this.triggerChangesOnRelated(d[this.options.keys.type],d[this.options.keys.id])}catch(a){}return d}syncPaging(a,b){let c=super.syncPaging(a,b);return c&&c.current&&(c.current[this.options.keys.links]=a[this.options.keys.links],c.current[this.options.keys.meta]=a[this.options.keys.meta]),c}mapRelationships(a){try{if(Array.isArray(a)||!(a[this.options.keys.type]&&a[this.options.keys.id]))for(const b in a)this.mapRelationships(a[b]);else if(a[this.options.keys.relationships]){const b=a[this.options.keys.type],c=a[this.options.keys.id];for(const d in a[this.options.keys.relationships])if(a[this.options.keys.relationships][d][this.options.keys.data])if(Array.isArray(a[this.options.keys.relationships][d][this.options.keys.data]))for(const e in a[this.options.keys.relationships][d][this.options.keys.data]){const f=a[this.options.keys.relationships][d][this.options.keys.data][e][this.options.keys.type],g=a[this.options.keys.relationships][d][this.options.keys.data][e][this.options.keys.id];this.mapRelationship(b,c,f,g)}else{const e=a[this.options.keys.relationships][d][this.options.keys.data][this.options.keys.type],f=a[this.options.keys.relationships][d][this.options.keys.data][this.options.keys.id];this.mapRelationship(b,c,e,f)}}}catch(a){console.error("MAP RELATIONSHIPS",a)}}mapRelationship(a,b,c,d){this._mapRelationships[a]||(this._mapRelationships[a]={}),this._mapRelationships[a][b]||(this._mapRelationships[a][b]={}),this._mapRelationships[a][b][c]||(this._mapRelationships[a][b][c]=[]),-1==this._mapRelationships[a][b][c].indexOf(d)&&this._mapRelationships[a][b][c].push(d),this._mapRelationships[c]||(this._mapRelationships[c]={}),this._mapRelationships[c][d]||(this._mapRelationships[c][d]={}),this._mapRelationships[c][d][a]||(this._mapRelationships[c][d][a]=[]),-1==this._mapRelationships[c][d][a].indexOf(b)&&this._mapRelationships[c][d][a].push(b)}body(a,c){let d=c.id?c.id:this.id(c),e={};return e[this.options.keys.data]={},e[this.options.keys.data][this.options.keys.type]=a,e[this.options.keys.data].attributes={},d&&(e[this.options.keys.data][this.options.keys.id]=d),c[this.options.keys.data]?b(e[this.options.keys.data],c[this.options.keys.data]):c.attributes?b(e[this.options.keys.data],c):b(e[this.options.keys.data].attributes,c),e[this.options.keys.data].attributes[this.options.keys.type]&&delete e[this.options.keys.data].attributes[this.options.keys.type],e[this.options.keys.data].attributes[this.options.keys.id]&&delete e[this.options.keys.data].attributes[this.options.keys.id],super.body(a,e)}triggerChangesOnRelated(a,b){if(!a||!b)return 0;if(!this._mapRelationships[a]||!this._mapRelationships[a][b])return 0;let c=0;for(const d in this._mapRelationships[a][b])for(const e of this._mapRelationships[a][b][d])++c,this._model[d][e].triggerChanges({relationships:{value:{type:a,id:b}}});return c}},a.StoreWordpress=class extends q{constructor(a){let c={baseUrl:"/wp-json/wp/v2",types:{page:"pages",post:"posts",category:"categories",tag:"tags",comment:"comments"},keys:{data:null,type:"type",id:"id"},query:{"page[number]":"page","page[size]":"defaultPageSize"},defaultPageSize:10};b(c,a||{}),super(c)}fetch(a,b){let c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return"string"==typeof b&&(c.slug=b,b=void 0),super.fetch(a,b,c)}},a.Util=j,a.View=s,a.ViewFile=v,a.ViewHandlebars=x,a}({});