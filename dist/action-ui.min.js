"use strict";var ActionUI=function(e){"use strict";/**
	 * Utilities
	 */ // Recursively copy source properties to target (Warning: Classes are treated as Objects)
function t(e,n){let o=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2];for(let a in o&&(n=Object.assign(Array.isArray(n)?[]:{},n)),n)n.hasOwnProperty(a)&&(o&&n[a]instanceof Object&&(n[a]=Object.assign(Array.isArray(n[a])?[]:{},n[a])),e.hasOwnProperty(a)?(o&&e[a]instanceof Object&&(e[a]=Object.assign(Array.isArray(e[a])?[]:{},e[a])),e[a]instanceof Object&&n[a]instanceof Object&&!(e[a]instanceof Function||n[a]instanceof Function)?t(e[a],n[a]):e[a]!=n[a]&&(e[a]=n[a])):e[a]=n[a],Array.isArray(e[a])&&Array.isArray(n[a])&&0==n[a].length&&0!=e[a].length&&(e[a]=[]));return e;// For simpler dereference usage
}function n(e,n){return t(e,n,!0)}function o(e){return"FORM"==e.tagName?e:e.form}function a(e){return e[0].toUpperCase()+e.substr(1).toLowerCase()}function i(e){return e.toLowerCase().replace(/[^a-zA-Z0-9]+(.)/g,(e,t)=>t.toUpperCase())}function s(e,t){return null==e||e.matches(t)?e:s(e.parentElement,t)}function r(e){let n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return n=Object.assign(Object.fromEntries(new FormData(e)),n),Object.entries(n).map(e=>{const o=e[0].split("[").map(e=>e.replace(/]/g,""));if(1<o.length){const a=p(o,e[1]);t(n,a),delete n[e[0]]}return e}),n}function p(e,t,n){const o=e.pop();if(!o)return n;let a={};return a[o]=n?n:t,p(e,t,a)}var l=/*#__PURE__*/Object.freeze({__proto__:null,deepAssign:t,deepCopy:n,requestFromElement:function(e){return new Request(e.action||options.href||null,{method:e.method||null})},form:o,capitalize:a,camelCase:i,firstMatchingParentElement:s,formToObject:r});/**
	 * Model
	 * @description Observable data object
	 */class d{constructor(){let e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=null;try{n=new Proxy(this,{set:this.constructor._proxySet,deleteProperty:this.constructor._proxyDelete})}catch(t){n=new Proxy(this,{set:this.constructor._proxySet})}// Set private properties
return n._options={triggerDelay:10},n._changes={},n._watchers=[],n._timer=null,n._parent=t,n._loading=!1,n.sync(e),n.clearChanges(),n}clear(){for(let t in this)try{delete this[t]}catch(n){// Fallback for IE11
let e=this[t];this[t]=void 0,this._change(t,void 0,e)}return this}loading(e){return 0==arguments.length?this._loading:void(this._loading=!!e)}// Sync data object to model
sync(e){return e=t({},e,!0),t(this,e),this}// Add watcher callback
watch(e){return this._watchers.push(e),this}clearChanges(){return this._changes={},this}triggerChanges(e){return e&&t(this._changes,e),this._trigger(!0)}// @deprecated
_privatize(){for(let e in this)"_"==e[0]&&Object.defineProperty(this,e,{enumerable:!1})}// Trigger all watcher callbacks
_trigger(){let e=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0];if(window.clearTimeout(this._timer),this._timer=null,e||0<Object.keys(this._changes).length){let e=this._watchers;for(let t in e)e[t].call(this,this._changes);null!=this._parent&&this._parent.model.triggerChanges({child:this,changes:this._changes}),this._changes={}}}// Log property change
_change(e,t,n){this._changes[e]={value:t,originalValue:n},this._timer||(this._timer=window.setTimeout(()=>this._trigger(),this._options.triggerDelay))}static _proxySet(e,t,n){let o=e[t];if(e[t]&&e[t]instanceof d)e[t].sync(n);else if(window.Reflect&&window.Reflect.set)!(n instanceof Object)||Array.isArray(n)||n instanceof d||"_"==t[0]||(n=new d(n,{model:e,property:t})),Reflect.set(e,t,n);else throw"Missing Model dependency: Reflect.set()";return"_"==t[0]?(Object.defineProperty(e,t,{enumerable:!1}),!0):(e._change(t,n,o),!0)}static _proxyDelete(e,t){if(t in e){let n=e[t];delete e[t],e._change(t,void 0,n)}return!0}}/**
	 * Action UI
	 * Allows named handlers to be handled as state-aware deferred promises with before/after events
	 */class c{constructor(e,t,n){this.name=e,this.handler=t||((e,t,n)=>e(n)),this.model=n?n:new d,this.running=!1,g.autoCache&&c.cache(this)}// trigger before event and run the handler as a promise 
run(e){let t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};g.verbose&&console.info("Action.run()",this.name,{action:this,target:e,data:t}),this.running=!0,e=e||document.body,t=Object.assign(t,c.data(e));let n=!this.before(e,t);var o=null;if(n)o=Promise.reject(new u("Canceled"));else if(this.handler instanceof Function)o=new Promise((e,n)=>this.handler(e,n,t));else if(this.handler instanceof Request){// If there is data to send, recreate the request with the data
if(0<Object.keys(t).length){let n={};for(let e in this.handler)n[e]=this.handler[e];if("POST"!=n.method)"GET"==n.method&&(// Append query string to URL with ?/& first as needed
n.url+=(0>n.url.indexOf("?")?"?":"&")+Object.keys(t).map(e=>e+"="+t[e]).join("&"));else if(e.attributes.enctype&&"application/json"==e.attributes.enctype.value)n.body=JSON.stringify(t);else{let e=new FormData;for(let n in t)e.append(n,t[n]);n.body=e}this.handler=new Request(n.url,n)}o=fetch(this.handler).then(e=>e.json().then(t=>e.ok?t:Promise.reject(t)))}return o.then(n=>this.after(e,!0,n,t),n=>this.after(e,!1,n,t))}syncModel(e){return e=t({},e,!0),g.verbose&&console.info("Action.syncModel()",this.name,{action:this,data:e}),e instanceof Object||(e={result:e}),this.model.sync&&this.model.sync instanceof Function?this.model.sync(e):this.model instanceof Object&&t(this.model,e),e}before(e,t){g.verbose&&console.info("Action.before()",this.name,{action:this,target:e,data:t}),c.setCssClass(e,g.cssClass.loading,t),c.reflectCssClass(this.name,g.cssClass.loading,t);let n=new CustomEvent(g.eventBefore.type,g.eventBefore);return Object.assign(n.detail,{name:this.name,data:t,model:this.model}),e.dispatchEvent(n)}after(e,t,n,o){g.verbose&&console.info("Action.after()",this.name,{action:this,target:e,data:o,success:t,result:n}),this.running=!1;var a=n instanceof u,i=t?g.cssClass.success:g.cssClass.fail;a&&(i=g.cssClass.canceled),c.setCssClass(e,i,o),c.reflectCssClass(this.name,i,o),null==n||n instanceof Error||this.syncModel(n);let s=new CustomEvent(g.eventAfter.type,g.eventAfter);return Object.assign(s.detail,{name:this.name,success:t,data:o,model:this.model,error:!!(n instanceof Error)&&n,canceled:a}),e.dispatchEvent(s),n}// #region Static methods
// Initialize the action cache and top-level event listener (only once)
static init(){document.addEventListener("click",t=>{let e=s(t.target,"[ui-action]");if(e&&"FORM"!=e.tagName&&!e.disabled&&!t.target.disabled){"INPUT"==e.tagName&&("checkbox"==e.type||"radio"==e.type)||t.preventDefault();var n=e.getAttribute("ui-action");// Don't run the action if it's already running
if(n in y)!1==y[n].running&&y[n].run(e);else if(g.autoCreate){// Auto create and run action
var o=c.createFromElement(e);c.cache(o),o.run(e)}else throw new Error("Action not found: "+n)}}),document.addEventListener("submit",t=>{if(t.target.matches("form[ui-action]")&&!t.target.disabled){t.preventDefault();var e=t.target.getAttribute("ui-action");// Don't run the action if it's already running
if(e in y)!1==y[e].running&&y[e].run(t.target);else if(g.autoCreate){// Auto create and run action
var n=c.createFromElement(t.target);c.cache(n),n.run(t.target)}else throw new Error("Action not found: "+e)}})}static create(e){let t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(g.verbose&&console.info(this.name+":create()",{options:e,fromCache:t}),!1=="name"in e)throw"No action name specfied";return!1=="handler"in e&&(!0=="url"in e&&e.url?e.handler=new Request(e.url,e.request||{}):e.handler=null),t?this.cache(e.name)||new this(e.name,e.handler,e.model):new this(e.name,e.handler,e.model)}static createFromElement(e){let t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return c.create(Object.assign({name:e.getAttribute("ui-action")||null,url:e.action||e.href||t.href||null,request:{method:e.method||t.method||"GET"}},t))}// Cache an action 
static cache(e){return null==e?y:"string"==typeof e?y[e]:e.name in y?this:(y[e.name]=e,this)}static data(e){var t=e.dataset||{},n=o(e);return n&&(t=r(n,t)),t}static get(e){return y[e]}static setCssClass(e,t){let n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!e.attributes["ui-nostate"]){if(null!=n&&!!e.attributes["ui-state-data"]){let t=!0,o=JSON.parse(e.attributes["ui-state-data"].value);for(let e in o)if(t=n[e]==o[e],!1===t)break;if(!1==t)return}for(var o in g.cssClass)e.classList.remove(g.cssClass[o]);e.classList.add(t)}}// Propagate class to all reflectors (ui-state and form submit buttons)
static reflectCssClass(e,t){let n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;document.querySelectorAll("form[ui-action=\""+e+"\"] [type=\"submit\"], form[ui-action=\""+e+"\"] button:not([type]), [ui-state=\""+e+"\"]").forEach(e=>c.setCssClass(e,t,n))}static get options(){return g}static set options(e){t(g,e)}// #endregion
}class u extends Error{}let y={},g={verbose:!1,autoCreate:!0,autoCache:!0,cssClass:{loading:"loading",success:"success",fail:"fail",canceled:"canceled"},eventBefore:new CustomEvent("action.before",{bubbles:!0,cancelable:!0,detail:{type:"before",name:null,data:null,model:null}}),eventAfter:new CustomEvent("action.after",{bubbles:!0,cancelable:!0,detail:{type:"after",name:null,data:null,success:null,model:null}})};c.init();/**
	 * Controller
	 * Provider route mapping for SPAs
	 */class h{constructor(e){this.view=e}__autoload(){return this.view.render()}__error(){return this.view.render()}get view(){return this._view}set view(e){this._view=e}}/**
	 * JsonApi
	 * @description Json API data store
	 * @tutorial var store = new JsonApi('http://localhost:8080/api', ['category', 'product'])
	 */ /**
	 * Store
	 * @version 20230126
	 * @description Remote data store
	 * @tutorial let store = new Store({baseUrl:'http://localhost:8080/api', types:['category', 'product']})
	 */class m{constructor(e){// Accept an array of store keys
if(this.options={baseUrl:null,types:null,keys:{data:null,type:"type",id:"id"},keysExcludeFromCache:[],defaultPageSize:0,query:{"page[number]":"page[number]","page[size]":"page[size]"},fetch:{method:"GET",headers:{"Content-Type":"application/json"},mode:"no-cors"},searchDepth:1,triggerChangesOnError:!0,// Allows views to update contents on failed requests, especially useful for Fetch All requests which return no results or 404
triggerChangesOnEmpty:!0,useUrlCache:!0,verbose:!1,viewClass:null,viewMap:{},actionVerb:{get:"fetch",post:"create",patch:"update",delete:"delete"},actionHandler:{get:this.actionHandler,post:this.actionHandler,patch:this.actionHandler,delete:this.actionHandler},eventBefore:new CustomEvent("store.before",{bubbles:!0,cancelable:!0,detail:{type:"before",name:null,fetch:null,type:null,data:null,model:null,view:null,query:null}}),eventAfter:new CustomEvent("store.after",{bubbles:!0,detail:{type:"after",name:null,fetch:null,type:null,data:null,model:null,view:null,success:null,response:null,json:null,query:null}})},t(this.options,e||{}),this._model=new d,this._urlCache={},this._model._paging={},this.options.types instanceof Array){let e={};// Turn them into seperate stores
for(let t in this.options.types)e[this.options.types[t]]=this.options.types[t];this.options.types=e}if(this.options.types instanceof Object)for(let e in this.options.types)this.modelCreate(this.options.types[e]);m.cache(this)}body(e,t){return JSON.stringify(t)}model(e,t){return t?this._model[e][t]:this._model[e]}modelCreate(e){let t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if("string"!=typeof e)throw new Error("Store: Cannot create model without `type`");if(!this._model[e]&&(this._model[e]=new d({_type:e},{model:this._model,property:e}),this.actionCreate(e,"get"),this.actionCreate(e,"post"),this.actionCreate(e,"patch"),this.actionCreate(e,"delete"),this.options.viewClass&&this.options.viewMap.hasOwnProperty(e)))if(Array.isArray(this.options.viewMap[e]))for(let t of this.options.viewMap[e])this.options.viewClass.create({name:t,file:t,model:this._model[e]});else{let t=this.options.viewMap[e];this.options.viewClass.create({name:t,file:t,model:this._model[e]})}return null==t||"string"!=typeof t&&"number"!=typeof t||this._model[e][t]||(this._model[e][t]=new d({_type:e},{model:this._model[e],property:t})),t?this._model[e][t]:this._model[e]}actionCreate(e,t){t=t.toLowerCase();var n=e+" "+this.options.actionVerb[t],o=this.options.actionHandler[t].bind(this,e,t),a=new c(n,o);return c.cache(a),a}actionHandler(e,t,n,o,a){let i=null;return"get"===t?i=this.fetch(e,a.id):"post"===t?i=this.post(e,a):"patch"===t?i=this.patch(e,a):"delete"===t?i=this.delete(e,a.id):void 0,i.then(e=>n(e)).catch(e=>o(e))}data(e){return this.options.keys.data?e[this.options.keys.data]:e}type(e){let t=e[this.options.keys.type];return this.options.types[t]&&(t=this.options.types[t]),t}id(e){return e[this.options.keys.id]}sync(e,t){let n=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2],o=this.data(e);if(!o||0==Object.keys(o).length)throw n||this.syncPaging(e,t),new Error("Store: No data to sync");if(o instanceof Array){let a={};for(let e in o){let n=null;this.options.keys.data?(n={},n[this.options.keys.data]=o[e]):n=o[e],a[this.id(o[e])]=this.sync(n,t)}return n||this.syncPaging(e,t),a}let a=this.type(o),i=this.id(o);if(this._model[a]||this.modelCreate(a),this._model[a][i]||this.modelCreate(a,i),!this._model[a][i])throw new Error("Store: No model for type: "+a+", id: "+i);return this._model[a][i].sync(o),t&&(!this._model[a][i].hasOwnProperty("_store")&&(this._model[a][i]._store={url:[]}),-1==this._model[a][i]._store.url.indexOf(t)&&this._model[a][i]._store.url.push(t),t=this.url({type:a,id:i}),-1==this._model[a][i]._store.url.indexOf(t)&&this._model[a][i]._store.url.push(t)),this._model[a][i]}syncPaging(e,t){let o=this.pageData(t);// Paging
if(o.type&&o.pageSize&&o.pageNumber){let a=this.pageKey(o.pageSize,o.query),i=this.data(e);if(Array.isArray(i)){let e=this.model(o.type),s=[],r=n({},o);for(let e of i)s.push({id:e[this.options.keys.id],type:e[this.options.keys.type]});r.data=s,r.url=[t],e._paging||(e._paging=new d({current:null,type:o.type,pageNumber:o.pageNumber,pageSize:o.pageSize,pageKey:a},{model:e,property:"_paging"})),e._paging[a]||(e._paging[a]=new d({},{model:e._paging,property:a})),e._paging[a][o.pageNumber]||(e._paging[a][o.pageNumber]=new d({},{model:e._paging[a],property:o.pageNumber})),e._paging[a][o.pageNumber].sync(r)}return this.pageChange(o.type,o.pageNumber,o.pageSize,o.query)}}url(e){let t=this.options.types[e.type]||e.type,n=this.options.baseUrl+"/"+t+"/"+(e.id?e.id+"/":""),o=new URLSearchParams;for(let t in e)t in this.options.query?o.set(this.options.query[t],e[t]):"type"!=t&&"id"!=t&&o.set(t,e[t]);o.sort();let a=o.toString();return a&&(n+="?"+a),n}urlParse(e){if(!e)return{url:null,type:null,pageNumber:!1,pageSize:!1};-1==e.indexOf("://")&&(0<e.indexOf("/")&&(e="/"+e),e=location.origin+e);let t=this.options.baseUrl;-1==t.indexOf("://")&&(0<t.indexOf("/")&&(t="/"+t),t=location.origin+t);let n=new URL(e),o=new URL(t),a=n.pathname.replace(o.pathname,"").split("/"),i=a[0]||a[1];n.searchParams.sort();let s={};return n.searchParams.forEach((e,t)=>s[t]=e),{url:n,type:i,pageNumber:parseInt(n.searchParams.get(this.options.query["page[number]"])),pageSize:parseInt(n.searchParams.get(this.options.query["page[size]"])),query:s}}search(e){let t=new d;for(let n in this._model)if(!(0==n.indexOf("_")||e.type&&this.type({type:e.type})!=n))for(let o in this._model[n]){let a=!1,i=this._model[n][o];for(let t in e)a=this.propertyValueExists(i,t,e[t],this.options.searchDepth);a&&(t[o]=i)}return t}propertyValueExists(e,t,n){let o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;var a=Object.keys(e);if(-1<a.indexOf(t))return e[t]==n;if(1>=o)return!1;for(let i of a)if("object"==typeof e[i])return this.propertyValueExists(e[i],t,n,o-1)}async fetch(e,t){let o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};e=this.type({type:e}),o=o||{},t=t||void 0,"object"==typeof t&&(o=t,t=o.id);let a={type:e,id:t},i={};n(i,this.options.fetch),this.before(e,i,a);let s=this.url(Object.assign({},o,a));return this.options.verbose&&console.info("Store.fetch()",e,t,{type:a.type,id:a.id,query:o,store:this,url:s,options:i}),this.fetchUrl(s,a.type,o,i,!0)}async fetchUrl(e,t){let o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,i=!!(4<arguments.length&&void 0!==arguments[4])&&arguments[4];if(!e)return Promise.reject();null==a&&n(a,this.options.fetch);try{o=o||{},o.type=t;let n=this.urlParse(e).url.toString(),s=this.urlCache(n);if(t=o.type||(s?s.type:null)||n.type||null,s)return this.pageChange(s.type,s.pageNumber,s.pageSize,s.pageData.query),Promise.resolve(s.model);i||this.before(t,a,o);const r=await fetch(e,a);let p=!0==r.ok?await r.json():{};if(this.after(t,this.options.fetch,o,!!r&&r.ok,r,p),!r.ok)return t&&this.options.triggerChangesOnError&&this._model[t]&&this.model(t).triggerChanges(),Promise.reject(p);try{let t=this.sync(p,e);return this.urlCache(n,t,p),t}catch(e){return t&&this.options.triggerChangesOnError&&this._model[t]&&this.model(t).triggerChanges(),Promise.reject(p)}}catch(e){return t&&this.options.triggerChangesOnError&&this._model[t]&&this.model(t).triggerChanges(),await Promise.reject(e)}}urlCache(e){let t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!this.options.useUrlCache)return!1;if(e=decodeURIComponent(e),!t&&!n)return this._urlCache[e];let o=this.pageData(e),a=t[this.options.keys.type]||t._type||(o?o.type:null);if(n)for(let e of this.options.keysExcludeFromCache)delete n[e];return this._urlCache[e]={url:e,type:a,model:t,json:n,pageData:o,pageNumber:!!o&&o.pageNumber,pageSize:!!o&&o.pageSize}}urlCacheClear(e){let t=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];if(!e)return void(this._urlCache={});let n=Object.keys(this._urlCache);for(var o of n)this._urlCache[o].type==e&&(!t||this._urlCache[o].pageNumber&&this._urlCache[o].pageSize)&&delete this._urlCache[o]}pageData(e){if(!e)return{type:null,pageNumber:!1,pageSize:!1};let t=this.urlParse(e),n=this._urlCache[e],o=t.pageSize||!!n&&n.pageSize,a=t.query||(n?n.query:{});return{type:t.type||(n?n.type:null),pageNumber:t.pageNumber||!!n&&n.pageNumber,pageSize:o,pageKey:this.pageKey(o,a),query:a,cached:!!n}}paging(e){return this.model(e)._paging||{current:!1,pageNumber:!1,pageSize:!1,pageKey:!1}}async pagingReset(e){this.urlCacheClear(e,!0);let t=!1,n=!1,o=!1;return this._model[e]._paging&&(this._model[e]._paging.current&&(t=this._model[e]._paging.current.pageNumber,n=this._model[e]._paging.current.pageSize,o=this._model[e]._paging.current.query,1>=this._model[e]._paging.current.data.length&&1<t&&--t),delete this._model[e]._paging),t&&n?this.page(e,t,n,o):Promise.resolve()}async page(e){let t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return o=o||{},n=parseInt(n)||this.options.defaultPageSize,t=parseInt(t)||1,o.type=e,o[this.options.query["page[number]"]]=t,o[this.options.query["page[size]"]]=n,await this.fetch(e,0,o)}pageChange(e,t,n){let o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},a=this.pageKey(n,o);return!!(e&&a&&t&&n&&this._model[e]._paging&&this._model[e]._paging[a][t])&&(this._model[e]._paging.pageNumber=t,this._model[e]._paging.pageSize=n,this._model[e]._paging.pageKey=a,delete this._model[e]._paging.current,this._model[e]._paging.current=this._model[e]._paging[a][t],this._model[e]._paging)}pageKey(e){let t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};t[this.options.query["page[size]"]]=e,delete t[this.options.query["page[number]"]];let n=new URLSearchParams(t);return n.sort(),n.toString()}post(e,t){let o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};e=e||this.type(t);let a={};n(a,this.options.fetch),a.method="POST",a.body=this.body(e,t),this.before(e,a,t,o);let i=this.url(Object.assign({},o,{type:e,id:this.id(t)}));return this.options.verbose&&console.info("Store.post()",e,{type:e,data:t,query:o,store:this,url:i,options:a}),fetch(i,a).then(n=>n.json().then(i=>n.ok?(this.after(e,a,t,!!n&&n.ok,n,i,o),i):Promise.reject(i))).then(e=>this.sync(e,i)).catch(t=>(this.options.triggerChangesOnError&&this.model(e).triggerChanges(),Promise.reject(t)))}patch(e,t){let o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};e=e||this.type(t);let a={};n(a,this.options.fetch),a.method="PATCH",a.body=this.body(e,t),this.before(e,a,t,o);let i=this.url(Object.assign({},o,{type:e,id:this.id(t)}));return this.options.verbose&&console.info("Store.patch()",e,{type:e,data:t,query:o,store:this,url:i,options:a}),fetch(i,a).then(n=>n.json().then(i=>n.ok?(this.after(e,a,t,!!n&&n.ok,n,i,o),i):Promise.reject(i))).then(e=>this.sync(e,i)).catch(t=>(this.options.triggerChangesOnError&&this.model(e).triggerChanges(),Promise.reject(t)))}delete(e,t){let o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},a={};a[this.options.keys.id]=t;let i={};n(i,this.options.fetch),i.method="DELETE",this.before(e,i,a,o);let s=this.url(Object.assign({},o,{type:e,id:a.id}));return this.options.verbose&&console.info("Store.delete()",e,t,{type:e,id:a.id,query:o,store:this,url:s,options:i}),fetch(s,i).then(t=>t.json().then(n=>t.ok?(this.after(e,i,a,!!t&&t.ok,t,n,o),n):Promise.reject(n))).then(n=>(delete this._model[e][t],this.sync(n,s))).then(()=>this.pagingReset(e).catch(()=>{})).catch(t=>(this.options.triggerChangesOnError&&this.model(e).triggerChanges(),Promise.reject(t)))}loading(e,t){this._model[e]||this.modelCreate(e);const n=this.model(e);return 1==arguments.length?n.loading():void n.loading(t)}before(e,t,n){let o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},a=this.options.baseUrl+"/"+e,i=null;this.loading(e,!0),this.options.viewClass&&this.options.viewMap.hasOwnProperty(e)&&(i=this.options.viewClass.cache(this.options.viewMap[e])),this.options.verbose&&console.info("Store.before()",a,{store:this,type:e,fetch:t,data:n,view:i,model:this.model(e),query:o}),i&&document.querySelectorAll("[ui-view=\""+i.name+"\"]").forEach(e=>{this.options.viewClass.setCssClass(e,this.options.viewClass.options.cssClass.loading)});let s=new CustomEvent(this.options.eventBefore.type,this.options.eventBefore);return Object.assign(s.detail,{name:a,fetch:t,store:this,type:e,data:n,model:this.model(e),view:i,query:o}),document.dispatchEvent(s)}after(e,t,n,o,a,i){let s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:{},r=this.options.baseUrl+"/"+e,p=null;this.loading(e,!1),this.options.viewClass&&this.options.viewMap.hasOwnProperty(e)&&(p=this.options.viewClass.cache(this.options.viewMap[e])),this.options.verbose&&console.info("Store.after()",r,{store:this,type:e,fetch:t,data:n,view:p,model:this.model(e),success:o,response:a,json:i,query:s}),p&&document.querySelectorAll("[ui-view=\""+p.name+"\"]").forEach(e=>{this.options.viewClass.setCssClass(e,o?this.options.viewClass.options.cssClass.success:this.options.viewClass.options.cssClass.fail)});let l=new CustomEvent(this.options.eventAfter.type,this.options.eventAfter);return Object.assign(l.detail,{name:r,success:o,fetch:t,store:this,type:e,data:n,model:this.model(e),view:p,response:a,json:i,query:s}),document.dispatchEvent(l)}static cache(e){if(null==e)return f;if("string"==typeof e){if(e=e.toLowerCase(),null!=f[e])return f[e];// Find a store that starts with the requested url to match ('/api/v1/entity' with a '/api/v1' store)
for(var t in f)if(t.startsWith(e))return f[t];return}var n=e.options.baseUrl.toLowerCase();return n in f?this:(f[n]=e,this)}}let f={};/**
	 * View
	 * @description Creates a view that will be inserted into elements with
	 * ui-view="{{name}}" and updated when its attached model changes
	 */class _{constructor(e,t,n){n instanceof d||(n=new d(n||{controller:null,data:{},dev:!1,error:null,method:null,path:null,view:null})),this._name=e,this._html=t,this._model=n,n.watch(e=>this.update(e)),this.constructor.options.autoCache&&_.cache(this)}clear(){return document.querySelectorAll("[ui-view=\""+this._name+"\"]").forEach(e=>{e.innerHTML=""}),this}// When the model updates
update(e){this.constructor.options.verbose&&console.info(this.constructor.name+".update()",this.name,{view:this,changes:e}),this.render()}// Render the model data into the view template for all elements with [ui-view=this.name]
/**
	     * Render view to all matching containers
	     * @returns Promise
	     */render(){this.constructor.options.verbose&&console.info(this.constructor.name+".render()",this.name,{view:this});let e=new CustomEvent(this.constructor.options.eventRender.type,this.constructor.options.eventRender),t=new CustomEvent(this.constructor.options.eventRenderBefore.type,this.constructor.options.eventRenderBefore);return Object.assign(t.detail,{name:this.model.view,view:this}),Object.assign(e.detail,{name:this.model.view,view:this}),document.querySelectorAll("[ui-view=\""+this._name+"\"]").forEach(n=>{let o=!n.dispatchEvent(t);o||(n.innerHTML=e.detail.view.html,n.dispatchEvent(e),this.renderSubviews(n))}),Promise.resolve()}renderSubviews(e){this.constructor.options.verbose&&console.info(this.constructor.name+".renderSubviews()",this.name,{view:this,parent:e}),e.querySelectorAll("[ui-view]").forEach(e=>{let t=e.getAttribute("ui-view"),n=this.constructor.cache(t);n&&n.render()})}get name(){return this._name}get html(){return this._html instanceof Function?this._html(this._model):this._html}set html(e){this._html=e}get model(){return this._model}// #region Static methods
// View factory
static create(e){let t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return this.options.verbose&&console.info(this.name+":create()",{options:e,fromCache:t}),t&&e.name?this.cache(e.name)||new this(e.name,e.html,e.model):new this(e.name,e.html,e.model)}// Cache a view 
static cache(e){if(this.options.verbose&&console.info(this.name+":cache()",{view:e}),"string"==typeof e)return v[e];if(e instanceof _){if(e.name in v)throw"View name already exists: \""+e.name+"\"";return v[e.name]=e,this}return v}// Render all views
static get options(){return b}static set options(e){t(b,e)}// #endregion
}let v={},b={verbose:!1,autoCache:!0,// Automatically cache views when created
eventRenderBefore:new CustomEvent("view.render.before",{bubbles:!0,cancelable:!0,detail:{type:"render.before",name:null,view:null}}),eventRender:new CustomEvent("view.render",{bubbles:!0,cancelable:!0,detail:{type:"render",name:null,view:null}})};/**
	 * ViewFile
	 * @description View that fetches html from a file
	 */class C extends _{constructor(e,t,n){2==arguments.length&&(n=t,t=void 0),t||(t=e),super(e,null,n),this.file=t}clear(){return this.html=null,super.clear()}render(){this.constructor.options.verbose&&console.info(this.constructor.name+".render()",this.name,{view:this});var e=null==this._html?this.fetch():Promise.resolve();return e.then(()=>super.render())}fetch(){return this.constructor.options.verbose&&console.info(this.constructor.name+".fetch()",this.name,{view:this}),this.fetchBefore(),fetch(this.fullPath).then(e=>{if(e.ok)return e.text();throw new Error(e.statusText)}).then(e=>(this._html=e,this.fetchAfter(!0),this._html)).catch(()=>{throw this.fetchAfter(!1),new Error("File not found: "+this.fileName)})}fetchBefore(){this.constructor.options.verbose&&console.info(this.constructor.name+".fetchBefore()",this.name,{view:this}),document.querySelectorAll("[ui-view=\""+this._name+"\"]").forEach(e=>{this.constructor.setCssClass(e,k.cssClass.loading)}),this.constructor.options.eventFetch&&(Object.assign(this.constructor.options.eventFetch.detail,{view:this,success:null}),document.dispatchEvent(this.constructor.options.eventFetch))}fetchAfter(e){this.constructor.options.verbose&&console.info(this.constructor.name+".fetchAfter()",this.name,{view:this}),document.querySelectorAll("[ui-view=\""+this._name+"\"]").forEach(t=>{this.constructor.setCssClass(t,e?k.cssClass.success:k.cssClass.fail)}),this.constructor.options.eventFetch&&(Object.assign(this.constructor.options.eventFetch.detail,{view:this,success:e}),document.dispatchEvent(this.constructor.options.eventFetch))}get fileName(){return this.file+"."+this.constructor.options.extension}get fullPath(){return this.constructor.options.basePath+this.fileName}get file(){return this._file}set file(e){e!=this._file&&(this._html=null),this._file=e}// #region Static methods
// View factory
static create(e){let t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return this.options.verbose&&console.info(this.name+":create()",{options:e,fromCache:t}),e.file||(e.file=e.name),t&&e.name?this.cache(e.name)||new this(e.name,e.file,e.model):new this(e.name,e.file,e.model)}static setCssClass(e,t){for(var n in k.cssClass)e.classList.remove(k.cssClass[n]);e.classList.add(t)}static get options(){return k}static set options(e){t(k,e)}// #endregion
}let k={basePath:"view/",extension:"html",cssClass:{loading:"loading",success:"success",fail:"fail"},eventFetch:new CustomEvent("view.fetch",{bubbles:!0,detail:{type:"fetch",view:null,success:null}}),eventRender:new CustomEvent("view.render",{bubbles:!0,cancelable:!0,detail:{type:"render",view:null}})};C.options=_.options;/**
	 * ViewHandlebars
	 * @description View that uses Handlebars templates instead of html
	 * @update Support for pre-compiled templates
	 */class w extends C{render(){this.constructor.options.verbose&&console.info(this.constructor.name+".render()",this.name,{view:this});var e=Promise.resolve();return null==this.html&&Handlebars.templates&&Handlebars.templates[this.file]&&(this.html=Handlebars.templates[this.file]),e.then(()=>super.render())}fetch(){return super.fetch().then(e=>("templates"in Handlebars||(Handlebars.templates=[]),Handlebars.templates[this.file]=Handlebars.compile(e),this.html=Handlebars.templates[this.file],e))}// #region Static methods
static get options(){return S}static set options(e){t(S,e)}// #endregion
}let S={};w.options=C.options,w.options.extension="hbs";let E={},A={controllers:{},view:"controller",state:{},autoload:!0,verbose:!1,cssClass:{loading:"loading",success:"success",fail:"fail"},defaultController:"default",autoloadMethod:"__autoload",defaultMethod:"index",errorMethod:"__error",errorView:"error",useControllerErrorViews:!1,devHost:"localhost",interceptLinks:!0,pathSeparator:"/",routes:{}};return e.Action=c,e.ActionErrorCanceled=u,e.Controller=h,e.JsonApi=class extends d{constructor(e,t){// Accept an array of store keys
if(t instanceof Array){// Turn them into seperate stores
let e=t;for(let n in t=new d,e)t[e[n]]=new d}t._paging={},super(t),this.baseUrl=e}sync(e){if(!e.hasOwnProperty("data"))throw new Error("JsonApi: No data to sync");if(e.data instanceof Array){let t={};for(let n in e.data)t[e.data[n].id]=this.sync({data:e.data[n]});return t;//this[json.data[0].type]
}let n=e.data.type,o=e.data.id;return this[n]||(this[n]=new d),this[n][o]||(this[n][o]=new d),t(this[n][o],e.data),this[n][o]}fetch(e,t){if(this[e]){if(null!=t&&this[e][t])return Promise.resolve(this[e][t]);if(null==t)return Promise.resolve(this[e])}return fetch(this.baseUrl+"/"+e+(t?"/"+t:"")).then(e=>e.json()).then(e=>this.sync(e))}page(e){let t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;if(n=parseInt(n)||0,t=parseInt(t)||1,e in this._paging&&n in this._paging[e]&&t in this._paging[e][n])return Promise.resolve().then(()=>this._paging[e][n][t]);e in this._paging||(this._paging[e]={}),n in this._paging[e]||(this._paging[e][n]={}),t in this._paging[e][n]||(this._paging[e][n][t]=new d({type:e,number:t,size:n,count:0,links:{},model:new d}));let o="?page[number]="+t;return 0<n&&(o+="&page[size]="+n),fetch(this.baseUrl+"/"+e+o).then(e=>e.json()).then(o=>this._paging[e][n][t].sync({links:o.links||{},count:Object.keys(o.data).length,model:this.sync(o)}))}post(){/*
	        data = {
	            id: '1',
	            attributes: {}
	        }
	        */}},e.Model=d,e.Router=class{static start(){window.addEventListener("popstate",this.onPopState.bind(this)),A.interceptLinks&&document.addEventListener("click",this.onClick.bind(this)),this.navigate(location.pathname)}static route(e,t){let n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;this.options.routes[e]={route:e,callback:t,priority:n}}static match(e){let t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];// Exact match
if(this.options.routes[e])return t&&"string"==typeof this.options.routes[e].callback?this.match(this.options.routes[e].callback):this.options.routes[e];let n=null;for(let t in Object.keys(this.options.routes))null!=e.match(t)&&(null==n||this.options.routes[t].priority<=n.priority)&&(n=this.options.routes[t]);// If route is a forward
return n&&t&&"string"==typeof n.callback&&(n=this.match(n.callback)),n}static navigate(t){let n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;A.verbose&&console.info("Router.navigate()",{router:this,route:t,data:n});let a=this.sanitizePath(t),s=a[0],r=a[1],p=this.controllerName(s),l={data:n},d=this.match(t,!1);if(d&&"string"==typeof d.callback)// Redirect
return this.navigate(d.callback,n,o);this.controllers[p]||(s=A.defaultController,p=this.controllerName(s),r="/"==t?A.defaultMethod:a[0]),E[p]||(this.controllers[p]?E[p]=new this.controllers[p](this.view):E[p]=new h(this.view)),r=r||A.defaultMethod;let u=null,y=s+A.pathSeparator+r,g=i(r);E[p].view instanceof C?E[p].view.file=y:E[p].view instanceof w&&(E[p].view.html=y),A.autoload&&!(E[p][g]instanceof Function)&&(g=A.autoloadMethod),l.dev=location.host==A.devHost,l.view=y,l.controller=s,l.method=r,l.path=Array.from(a),l.event=o;// Query string to object
let m=location.search.substring(1);m&&(m=JSON.parse("{\""+decodeURI(m).replace(/"/g,"\\\"").replace(/&/g,"\",\"").replace(/=/g,"\":\"")+"\"}"),l.search=m);try{let e=Array.from(a);if(e.shift(),e.shift(),e.push(m),e.push(n),!d)E[p].view.model.clear().sync(l).clearChanges(),u=E[p][g].apply(E[p],e),this.pushState(t,{controller:s,method:r,data:Object.assign({},n),search:m});else if(d.callback instanceof c){d.callback.model.clear().sync(l).clearChanges();let e=o?o.target:document;u=d.callback.run(e,n)}else e.push(l),u=d.callback.apply(E[p],e)}catch(o){this.options.verbose&&console.error("Routing Error",o),this.pushState(t,{controller:s,method:r,data:Object.assign({},n),search:m}),u=this.handleError(p,l,a)}if(u instanceof Promise){let t=document.querySelectorAll("[ui-view=\""+this.view.name+"\"]");this.handleLoading(t,!0),u.then(()=>this.handleLoading(t,!1)).catch(n=>{throw this.handleLoading(t,!1),this.handleError(p,l,a,n),n})}return u}static handleLoading(e,t){return t?e.forEach(e=>e.classList.add(A.cssClass.loading)):e.forEach(e=>e.classList.remove(A.cssClass.loading)),this}static handleError(e,t,n,o){return t.error=o,t.view=t.controller+A.pathSeparator+A.errorView,t.path=n.join(A.pathSeparator),E[e].view instanceof C?E[e].view.file=(A.useControllerErrorViews?t.controller+A.pathSeparator:"")+A.errorView:E[e].view.html="Error loading "+t.path,E[e].view.model.clear().sync(t).clearChanges(),E[e][A.errorMethod]()}static sanitizePath(e){for(let t in A.verbose&&console.info("Router.sanitizePath()",{router:this,path:e}),"string"==typeof e&&(e=e.split("/"),e.shift(),e[0]=e[0]||A.defaultController),e)e[t]=(e[t]+"").toLowerCase();return 1==e.length&&e.push(A.defaultMethod),e}static controllerName(e){return A.verbose&&console.info("Router.controllerName()",{router:this,name:e}),a(i(e))+"Controller"}static pushState(e){let n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};location.pathname!=e&&(n.route=e,t(this.state,n),history.pushState(this.state,null,e))}static onClick(t){"A"==t.target.tagName&&t.target.pathname&&(t.preventDefault(),this.navigate(t.target.pathname,Object.assign({},t.target.dataset),t))}static onPopState(t){A.verbose&&console.info("Router.changeState()",{router:this,event:t});let e=location.pathname,n={};t.state&&(e=t.state.route,n=t.state.data),this.navigate(e,n)}// #region Properties
static get controllers(){return this.options.controllers}static set controllers(e){this.options.controllers=e}static get state(){return this.options.state}static set state(e){this.options.state=e}static get view(){return this.options.view instanceof _||(this.view=this.options.view),this.options.view}static set view(e){this.options.view=e instanceof _?e:new C(e)}static get options(){return A}static set options(e){t(A,e)}// #endregion
},e.Store=m,e.StoreJsonApi=class extends m{constructor(e){let n={keys:{data:"data",type:"type",id:"id",links:"links",meta:"meta",included:"included",relationships:"relationships"},keysExcludeFromCache:["data","included"],query:{"page[number]":"page[number]","page[size]":"page[size]"},defaultPageSize:0,fetch:{headers:{"Content-Type":"application/vnd.api+json"}},searchDepth:2};t(n,e||{}),super(n),this._mapRelationships={}}sync(e,t){let n=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2];if(e[this.options.keys.included]){let n={[this.options.keys.data]:e[this.options.keys.included]};this.sync(n,t,!0)}let o=super.sync(e,t,n);this.mapRelationships(o);try{if(Array.isArray(o)||!(o[this.options.keys.type]&&o[this.options.keys.id]))for(const e in o)o[e].hasOwnProperty(this.options.keys.type)&&o[e].hasOwnProperty(this.options.keys.id)&&this.triggerChangesOnRelated(o[e][this.options.keys.type],o[e][this.options.keys.id]);else this.triggerChangesOnRelated(o[this.options.keys.type],o[this.options.keys.id])}catch(t){}return o}syncPaging(e,t){let n=super.syncPaging(e,t);return n&&n.current&&(n.current[this.options.keys.links]=e[this.options.keys.links],n.current[this.options.keys.meta]=e[this.options.keys.meta]),n}mapRelationships(e){try{if(Array.isArray(e)||!(e[this.options.keys.type]&&e[this.options.keys.id]))for(const t in e)this.mapRelationships(e[t]);else if(e[this.options.keys.relationships]){const t=e[this.options.keys.type],n=e[this.options.keys.id];for(const o in e[this.options.keys.relationships])if(e[this.options.keys.relationships][o][this.options.keys.data])if(Array.isArray(e[this.options.keys.relationships][o][this.options.keys.data]))for(const a in e[this.options.keys.relationships][o][this.options.keys.data]){const i=e[this.options.keys.relationships][o][this.options.keys.data][a][this.options.keys.type],s=e[this.options.keys.relationships][o][this.options.keys.data][a][this.options.keys.id];this.mapRelationship(t,n,i,s)}else{const a=e[this.options.keys.relationships][o][this.options.keys.data][this.options.keys.type],i=e[this.options.keys.relationships][o][this.options.keys.data][this.options.keys.id];this.mapRelationship(t,n,a,i)}}}catch(t){console.error("MAP RELATIONSHIPS",t)}}mapRelationship(e,t,n,o){this._mapRelationships[e]||(this._mapRelationships[e]={}),this._mapRelationships[e][t]||(this._mapRelationships[e][t]={}),this._mapRelationships[e][t][n]||(this._mapRelationships[e][t][n]=[]),-1==this._mapRelationships[e][t][n].indexOf(o)&&this._mapRelationships[e][t][n].push(o),this._mapRelationships[n]||(this._mapRelationships[n]={}),this._mapRelationships[n][o]||(this._mapRelationships[n][o]={}),this._mapRelationships[n][o][e]||(this._mapRelationships[n][o][e]=[]),-1==this._mapRelationships[n][o][e].indexOf(t)&&this._mapRelationships[n][o][e].push(t)}body(e,n){let o=n.id?n.id:this.id(n),a={};return a[this.options.keys.data]={},a[this.options.keys.data][this.options.keys.type]=e,a[this.options.keys.data].attributes={},o&&(a[this.options.keys.data][this.options.keys.id]=o),n[this.options.keys.data]?t(a[this.options.keys.data],n[this.options.keys.data]):n.attributes?t(a[this.options.keys.data],n):t(a[this.options.keys.data].attributes,n),a[this.options.keys.data].attributes[this.options.keys.type]&&delete a[this.options.keys.data].attributes[this.options.keys.type],a[this.options.keys.data].attributes[this.options.keys.id]&&delete a[this.options.keys.data].attributes[this.options.keys.id],super.body(e,a)}triggerChangesOnRelated(e,t){if(!e||!t)return 0;if(!this._mapRelationships[e]||!this._mapRelationships[e][t])return 0;let n=0;for(const o in this._mapRelationships[e][t])for(const a of this._mapRelationships[e][t][o])++n,this._model[o][a].triggerChanges({relationships:{value:{type:e,id:t}}});return n}},e.StoreWordpress=class extends m{constructor(e){let n={baseUrl:"/wp-json/wp/v2",types:{page:"pages",post:"posts",category:"categories",tag:"tags",comment:"comments"},keys:{data:null,type:"type",id:"id"},query:{"page[number]":"page","page[size]":"defaultPageSize"},defaultPageSize:10};t(n,e||{}),super(n)}fetch(e,t){let n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return"string"==typeof t&&(n.slug=t,t=void 0),super.fetch(e,t,n)}},e.Util=l,e.View=_,e.ViewFile=C,e.ViewHandlebars=w,e}({});